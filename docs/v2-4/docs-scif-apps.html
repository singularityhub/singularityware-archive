<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="description" content="   Standard Integration Format (SCI-F) Apps   These docs are for Singularity Version 2.4. For older versions, see our archive                                         Why do we need SCI-F?SCI-F provides internal modularity of containers, and it makes it easy for the creator to give the container implied metadata about software. For example, installing a set of libraries, defining environment variables, or adding lables that belong to app foo makes a strong assertion that those dependencies belong to foo. When I run foo, I can be confident that the container is running in this context, meaning with foo's custom environment, and with foo’s libraries and executables on the path. This is drastically different from serving many executables in a single container, because there is no way to know which are associated with which of the container’s intended functions.  This documentation will walk through some rationale, background, and examples of modular apps for Singularity containers. If you are interested in the background and rationale for the format, see it’s home here. If you are interested in a combined background and tutorial with asciinema, we’ve prepared that for you here. This page will primarily cover how SCI-F works with Singularity images.To start, let’s take a look at this series of steps to install dependencies for software foo and bar.%post# install dependencies 1# install software A (foo)# install software B (bar)# install software C (foo)# install software D (bar)The creator may know that A and C were installed for foo and B and D for bar, but down the road, when someone discovers the container, if they can find the software at all, the intention of the container creator would be lost. As many are now, containers without any form of internal organization and predictibility are black boxes. We don’t know if some software installed to /opt, or to /usr/local/bin, or to their custom favorite folder /code. We could assume that the creator added important software to the path and look in these locations, but that approach is still akin to fishing in a swamp. We might only hope that the container’s main function, the Singularity runscript, is enough to make the container perform as intended.Mixed up ModulesIf your container truly runs one script, the traditional model of a runscript fits well. Even in the case of having two functions like foo and bar you probably have something like this.%runscriptif some logic to choose foo:   check arguments for foo   run fooelse if some logic to choose bar:   run barand maybe your environment looks like this:%environmentBEST_GUY=fooexport BEST_GUYbut what if you run into this issue, with foo and bar?%environmentBEST_GUY=fooBEST_GUY=barexport BEST_GUYYou obviously can’t have them at separate times. You’d have to source some custom environment file (that you make on your own) and it gets hard easily with issues of using shell and sourcing. We don’t know who the best guy is! You probably get the general idea. Without internal organization and modularity:  You have to do a lot of manual work to expose the different software to the user via a custom runscript (and be a generally decent programmer).  All software must share the same metadata, environment, and labels.Under these conditions, containers are at best block boxes with unclear delineation between software provided, and only one context of running anything. The container creator shouldn’t need to spend inordinate amounts of time writing custom runscripts to support multiple functions and inputs. Each of foo and bar should be easy to define, and have it’s own runscript, environment, labels, tests, and help section.Container TransparencySCI-F Apps make foo and bar transparent, and solve this problem of mixed up modules. Our simple issue of mixed up modules could be solved if we could do this:Bootstrap:dockerFrom: ubuntu:16.04%appenv fooBEST_GUY=fooexport BEST_GUY%appenv barBEST_GUY=barexport BEST_GUY%apprun fooecho The best guy is $BEST_GUY%apprun barecho The best guy is $BEST_GUYGenerate the container, and run it in the context of foo and then bar$ singularity run --app bar foobar.img The best guy is bar$ singularity run --app foo foobar.img The best guy is fooUsing SCI-F apps, a user can easily discover both foo and bar without knowing anything about the container:singularity apps foobar.imgbarfooand inspect each one:singularity inspect --app foo  foobar.img {    "SINGULARITY_APP_NAME": "foo",    "SINGULARITY_APP_SIZE": "1MB"}Container ModularityWhat is going on, under the hood? Just a simple, clean organization that is tied to a set of sections in the build recipe relevant to each app. For example, I can specify custom install procedures (and they are relevant to each app’s specific base defined under /scif/apps), labels, tests, and help sections. Before I tell you about the sections, I’ll briefly show you what the organization looks like, for each app:/scif/apps/     foo/        bin/        lib/        scif/            runscript.help            runscript            env/                01-base.sh                 90-environment.sh     bar/     ....If you are familiar with Singularity, the above will look very familiar. It mirrors the Singularity (main container) metadata folder, except instead of .singularity.d we have scif. The name and base scif is chosen intentionally to be something short, and likely to be unique. On the level of organization and metadata, these internal apps are like little containers! Are you worried that you need to remember all thispath nonsense? Don’t worry, you don’t. You can just use environment variables in your runscripts, etc. Here we are looking at the environment active for lolcat:singularity exec --app lolcat scif.img env | grep lolcatSINGULARITY_APPOUTPUT=/scif/data/lolcat/outputBEST_APP=lolcatLD_LIBRARY_PATH=/scif/apps/lolcat/lib:/.singularity.d/libsAPPDATA_lolcat=/scif/data/lolcatSINGULARITY_APPDATA=/scif/data/lolcatPATH=/scif/apps/lolcat/bin:/scif/apps/lolcat:/usr/games:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binSINGULARITY_APPINPUT=/scif/data/lolcat/inputAPPROOT_lolcat=/scif/apps/lolcatSINGULARITY_APPROOT=/scif/apps/lolcatSINGULARITY_APPNAME=lolcatSINGULARITY_APPMETA=/scif/apps/lolcat/scifNotice a few things!  the specific environment (%appenv lolcat) is active because BEST_APP is lolcat  the lib folder in lolcat’s base is added to the LD_LIBRARY_PATH  the bin folder is added to the path  locations for input, output, and general data are exposed. It’s up to you how you use these, but you can predictably know that a well made app will look for inputs and outputs in it’s specific folder.  environment variables are provided for the app’s root, it’s data, and it’s nameIf you need to interact with other app’s during the execution of an app, the base and data folders are provided too (note I filtered this list to show the relevant):singularity exec --app lolcat scif.img env | grep APPAPPDATA_cowsay=/scif/data/cowsayAPPROOT_cowsay=/scif/apps/cowsayAPPROOT_lolcat=/scif/apps/lolcatAPPDATA_lolcat=/scif/data/lolcatAPPDATA_fortune=/scif/data/fortuneAPPROOT_fortune=/scif/apps/fortuneAlso provided are more global paths for data and apps:SINGULARITY_APPS=/scif/appsSINGULARITY_DATA=/scif/dataImportantly, each app has its own modular location. When you do an %appinstall foo, the commands are all done in context of that base. The bin and lib are also automatically generated. So what would be a super simple app? Just add a script and name it:%appfiles foorunfoo.sh   bin/runfoo.shand then maybe for install I’d make it executable%appinstall foochmod u+x bin/runfoo.shYou don’t even need files! You could just do this.%appinstall fooecho 'echo "Hello Foo."' &gt;&gt; bin/runfoo.shchmod u+x bin/runfoo.shFinding the section %appinstall, %apphelp, or %apprun is indication of an application command. The following string is parsed as the name of the application, and this folder is created, in lowercase, under /scif/apps if it doesn’t exist.  A singularity metadata folder, .singularity.d, equivalent to the container’s main folder, is generated inside the application. An application thus is like a smaller image inside of it’s parent.Specifically, SCI-F defines the following new sections for the build recipe, where each is optional for 0 or more apps:%appinstall corresponds to executing commands within the folder to install the  application. These commands would previously belong in %post, but are now attributable to the application.%apphelpis written as a file called runscript.help in the application’s metadata folder,  where the Singularity software knows where to find it. If no help section is provided, the software simply will alert the user and show the files provided for inspection.%apprun is also written as a file called runscript.exec in the application’s metadata folder, and again looked for when the user asks to run the software. If not found, the container should default to shelling into that location.%applabels will write a labels.json in the application’s metadata  folder, allowing for application specific labels.%appenvwill write an environment file in the application’s base folder, allowing for definition of application specific environment variables.%apptestwill run tests specific to the application, with present working directory assumed to be the software module’s folder%appfileswill add files to the app’s base at /scif/apps/&lt;app&gt;Singularity containers are already reproducible in that they package dependencies. This basic format adds to that by making the software inside of them modular, predictable, and programmatically accessible. We can say confidently that some set of steps, labels, or variables in the runscript is associated with a particular action of the container. We can better reveal how dependencies relate to each step in a scientific workflow.  Making containers is not easy. When a scientist starts to write a recipe for his set of tools, he probably doesn’t know where to put it, perhaps that a help file should exist, or that metadata about the software should be served by the container. If container generation software made it easy to organize and capture container content automatically, we would easily meet these goals of internal modularity and consistency, and generate containers that easily integrate with external hosts, data, and other containers. These are essential components for (ultimately) optimizing the way we develop, understand, and execute our scientific containers.Cowsay ContainerNow let’s go through the tutorial to build our cowsay container.Important! This tutorial is for Singularity 2.4, which is still under the development branch. You need to clone development and install it first before using the build command:git clone -b development https://www.github.com/singularityware/singularity.gitcd singularity./autogen.sh./configure --prefix=/usr/localmakesudo make installWhen you’ve installed 2.4, download the recipe, and save it to your present working directory. By the way, credit for anything and everything lolcat and cowsay goes to @GodLoveD! Here is the recipe:wget https://raw.githubusercontent.com/singularityware/singularity/development/examples/apps/Singularity.cowsaysudo singularity build moo.img Singularity.cowsayNote that when development is merged into master, you may need to change “development”  in the address above to master.What apps are installed?singularity apps moo.imgcowsayfortunelolcatAsk for help for a specific app!singularity help --app fortune moo.imgfortune is the best appAsk for help for all apps, without knowing in advance what they are:for app in $(singularity apps moo.img)   do     singularity help --app $app moo.imgdonecowsay is the best appfortune is the best applolcat is the best appRun a particular appsingularity run --app fortune moo.img	My dear People.	My dear Bagginses and Boffins, and my dear Tooks and Brandybucks,and Grubbs, and Chubbs, and Burrowses, and Hornblowers, and Bolgers,Bracegirdles, Goodbodies, Brockhouses and Proudfoots.  Also my goodSackville Bagginses that I welcome back at last to Bag End.  Today is myone hundred and eleventh birthday: I am eleventy-one today!"		-- J. R. R. TolkienAdvanced running - pipe the output of fortune into lolcat, and make a fortunethat is beautifully colored!singularity run --app fortune moo.img | singularity run --app lolcat moo.imgYou will be surrounded by luxury.This one might be easier to see - pipe the same fortune into the cowsay app:singularity run --app fortune moo.img | singularity run --app cowsay moo.img ________________________________________/ Executive ability is prominent in your \\ make-up.                               / ----------------------------------------        \   ^__^         \  (oo)\_______            (__)\       )\/\                ||----w |                ||     ||and the final shabang - do the same, but make it colored. Let’s even get lazy and usean evironment variable for the command:CMD="singularity run --app"$CMD fortune moo.img | $CMD cowsay moo.img | $CMD lolcat moo.img _________________________________________/ Ships are safe in harbor, but they were \\ never meant to stay there.              / -----------------------------------------        \   ^__^         \  (oo)\_______            (__)\       )\/\                ||----w |                ||     ||Yes, you need to watch the asciinema to see the colors. Finally, inspect an app: singularity inspect --app fortune moo.img {    "SINGULARITY_APP_NAME": "fortune",    "SINGULARITY_APP_SIZE": "1MB"}If you haven’t yet, take a look at these examples with the asciinema!                Previous        Next                 Edit me                                                                                                                                                 Site last generated: Oct 12, 2017                             ">


<meta name="name" content="Standard Integration Format (SCI-F) Apps">

<meta name="thumbnail" content="http://singularity.lbl.gov/images/logo/logo.svg">




<title>Standard Integration Format (SCI-F) Apps | Singularity</title>
<link rel="stylesheet" href="assets/css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="assets/css/modern-business.css">
<link rel="stylesheet" href="assets/css/lavish-bootstrap.css">
<link rel="stylesheet" href="assets/css/customstyles.css">
<link rel="stylesheet" href="assets/css/theme-blue.css">

<link rel="stylesheet" type="text/css" href="assets/css/asciinema-player.css" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="assets/js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="assets/js/toc.js"></script>
<script src="assets/js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4005feed.xml">

    <script>
        $(document).ready(function() {

            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- asciinema player -->
<script src="assets/js/asciinema-player.js"></script>

<!-- Show or hide players on button clicks-->
<script>
$( document ).ready(function() {
    $(".asciinema-button").click(function(){
        console.log('rawwwr!')
        var asciinemaVideo = "#" + $(this).attr('data-id');
        if ($(asciinemaVideo).hasClass('hidden')){
            $(asciinemaVideo).removeClass('hidden');
            $(this).text('Hide Tutorial')
        } else {
            $(asciinemaVideo).addClass('hidden');
            $(this).text('Show Tutorial')
        }
        
    });
});
</script>

<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Singularity</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="blog">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Docs<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="admin-guide">Admin Guide</a></li>
                        
                        
                        
                        <li><a href="user-guide">User Guide</a></li>
                        
                        
                        
                        <li><a href="archive">Archive</a></li>
                        
                        
                        
                        <li><a href="links">Contributed Content</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Quick Links<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/singularityware/singularity" target="_blank">Github Repo</a></li>
                        
                        
                        
                        <li><a href="https://groups.google.com/a/lbl.gov/forum/#!forum/singularity" target="_blank">Google Group</a></li>
                        
                        
                        
                        <li><a href="http://stackoverflow.com/questions/tagged/singularity" target="_blank">Singularity on Stack Overflow</a></li>
                        
                        
                        
                        <li><a href="https://singularity-hub.org/faq" target="_blank">Singularity Hub</a></li>
                        
                        
                        
                        <li><a href="https://singularity-container.slack.com" target="_blank">Slack</a></li>
                        
                        
                        
                        <li><a href="faq#troubleshooting">Troubleshooting</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">People<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/gmkurtzer" target="_blank">Gregory M. Kurtzer</a></li>
                        
                        
                        
                        <li><a href="https://github.com/vsoch" target="_blank">Vanessa Sochat</a></li>
                        
                        
                        
                        <li><a href="https://github.com/bauerm97" target="_blank">Michael Bauer</a></li>
                        
                        
                        
                        <li><a href="https://github.com/bbockelm" target="_blank">Brian Bockelman</a></li>
                        
                        
                        
                        <li><a href="https://github.com/singularityware/singularity/blob/master/AUTHORS.md" target="_blank">Complete Authors List</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <li><a href="/search"><i class="fa fa-search"></i></li>
                <!-- jekyll search hidden in favor of google
                <li>
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="assets/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Standard Integration Format (SCI-F) Apps">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">
          






<ul id="mysidebar" class="nav">

    
    <div class="shiny"><a href="\"><figure><img src="/images/logo/logo.svg" class="sidebar-logo"/></figure></a></div>
    

    <li class="sidebarTitle">User Guide</li>
    
    
    
    <li>
        <a href="#">Getting Started</a>
        <ul>
            
            
            
            <li><a href="user-guide">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="docs-installation">Installation</a></li>
            
            
            
            
            
            
            <li><a href="quickstart">Quick Start</a></li>
            
            
            
            
            
            
            <li><a href="docs-build-container">Build a Container</a></li>
            
            
            
            
            
            
            <li><a href="docs-recipes">Container Recipes</a></li>
            
            
            
            
            
            
            <li><a href="docs-flow">Singularity Flow</a></li>
            
            
            
            
            
            
            <li><a href="docs-mount">Bind Paths and Mounts</a></li>
            
            
            
            
            
            
            <li><a href="docs-overlay">Persistent Overlays</a></li>
            
            
            
            
            
            
            <li><a href="docs-instances">Running Services</a></li>
            
            
            
            
            
            
            <li><a href="docs-user-checks">Container Checks</a></li>
            
            
            
            
            
            
            <li><a href="docs-environment-metadata">Environment and Metadata</a></li>
            
            
            
            
            
            
            <li class="active"><a href="docs-scif-apps">Reproducible SCI-F Apps</a></li>
            
            
            
            
            
            
            <li><a href="docs-docker">Singularity and Docker</a></li>
            
            
            
            
            
            
            <li><a href="faq#troubleshooting">Troubleshooting</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Commands</a>
        <ul>
            
            
            
            <li><a href="docs-usage">Command Usage</a></li>
            
            
            
            
            
            
            <li><a href="docs-build">build</a></li>
            
            
            
            
            
            
            <li><a href="docs-exec">exec</a></li>
            
            
            
            
            
            
            <li><a href="docs-inspect">inspect</a></li>
            
            
            
            
            
            
            <li><a href="docs-pull">pull</a></li>
            
            
            
            
            
            
            <li><a href="docs-run">run</a></li>
            
            
            
            
            
            
            <li><a href="docs-shell">shell</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Image Command Group</a>
        <ul>
            
            
            
            <li><a href="docs-export">image.export</a></li>
            
            
            
            
            
            
            <li><a href="docs-expand">image.expand</a></li>
            
            
            
            
            
            
            <li><a href="docs-import">image.import</a></li>
            
            
            
            
            
            
            <li><a href="docs-create">image.create</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Instance Command Group</a>
        <ul>
            
            
            
            <li><a href="docs-instance-start">instance.start</a></li>
            
            
            
            
            
            
            <li><a href="docs-instance-list">instance.list</a></li>
            
            
            
            
            
            
            <li><a href="docs-instance-stop">instance.stop</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Deprecated</a>
        <ul>
            
            
            
            <li><a href="docs-bootstrap">bootstrap</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main">Standard Integration Format (SCI-F) Apps</h1>
   <small style="color: #666; margin-top:50px; font-variant:italic">These docs are for Singularity Version 2.4. For older versions, see our <a class="no-after" 
                                                               href="https://singularityware.github.io/archive">archive</a></small>
</div>



<div class="post-content">

   

    <!-- Previous and next buttons-->
    <div class="row" style="padding-top:30px; margin-bottom:10px"><div class="col-md-12">
        <a href="#"><button style="float:left" class="hidden previous-button btn btn-circle btn-default"><i class="fa-2x fa fa-angle-double-left"></i></button></a>
        <a href="#"><button style="float:right" class="hidden next-button btn btn-circle btn-default"><i class="fa fa-angle-double-right fa-2x"></i></button></a>
    </div></div>

    <script>
    $(document).ready(function(){

        var next = $("li.active").next().last().find('a').attr('href');
        var previous = $("li.active").prev().last().find('a').attr('href');

        // NEXT BUTTON
        if (typeof next == 'undefined'){
            console.log("disabling next button")
            $(".next-button").addClass("hidden")
        } else if (next == "#") {
            next = $("li.active").next().find("li").first().find('a').attr('href');
            $(".next-button").closest('a').attr('href', next)
            $(".next-button").removeClass('hidden')
        } else {
            $(".next-button").closest('a').attr('href', next)
            $(".next-button").removeClass('hidden')
        }

        // PREVIOUS BUTTON
        if (typeof previous == 'undefined'){
            console.log("disabling previous button")
            $(".previous-button").addClass("hidden")
        } else if (previous == "#") {
            previous = $("li.active").prev().find("li").last().find('a').attr('href')
            $(".previous-button").closest('a').attr('href', previous)
            $(".previous-button").removeClass('hidden')
        } else {
            $(".previous-button").closest('a').attr('href', previous)
            $(".previous-button").removeClass('hidden')
        }

    })
    </script>

    

  <h2 id="why-do-we-need-sci-f">Why do we need SCI-F?</h2>
<p>SCI-F provides internal modularity of containers, and it makes it easy for the creator to give the container implied metadata about software. For example, installing a set of libraries, defining environment variables, or adding lables that belong to app <code class="highlighter-rouge">foo</code> makes a strong assertion that those dependencies belong to <code class="highlighter-rouge">foo</code>. When I run <code class="highlighter-rouge">foo</code>, I can be confident that the container is running in this context, meaning with <code class="highlighter-rouge">foo's</code> custom environment, and with <code class="highlighter-rouge">foo</code>’s libraries and executables on the path. This is drastically different from serving many executables in a single container, because there is no way to know which are associated with which of the container’s intended functions.  This documentation will walk through some rationale, background, and examples of modular apps for Singularity containers. If you are interested in the background and rationale for the format, see it’s <a href="http://containers-ftw.org/SCI-F/" target="_blank">home here</a>. If you are interested in a combined background and tutorial with asciinema, we’ve prepared that for you <a href="http://containers-ftw.org/apps/examples/tutorials/getting-started" target="_blank">here</a>. This page will primarily cover how SCI-F works with Singularity images.</p>

<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

<p>To start, let’s take a look at this series of steps to install dependencies for software foo and bar.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%post

# install dependencies 1
# install software A (foo)
# install software B (bar)
# install software C (foo)
# install software D (bar)
</code></pre>
</div>

<p>The creator may know that A and C were installed for <code class="highlighter-rouge">foo</code> and B and D for <code class="highlighter-rouge">bar</code>, but down the road, when someone discovers the container, if they can find the software at all, the intention of the container creator would be lost. As many are now, containers without any form of internal organization and predictibility are black boxes. We don’t know if some software installed to <code class="highlighter-rouge">/opt</code>, or to <code class="highlighter-rouge">/usr/local/bin</code>, or to their custom favorite folder <code class="highlighter-rouge">/code</code>. We could assume that the creator added important software to the path and look in these locations, but that approach is still akin to fishing in a swamp. We might only hope that the container’s main function, the Singularity runscript, is enough to make the container perform as intended.</p>

<h3 id="mixed-up-modules">Mixed up Modules</h3>
<p>If your container truly runs one script, the traditional model of a runscript fits well. Even in the case of having two functions like <code class="highlighter-rouge">foo</code> and <code class="highlighter-rouge">bar</code> you probably have something like this.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%runscript

if some logic to choose foo:
   check arguments for foo
   run foo
else if some logic to choose bar:
   run bar
</code></pre>
</div>

<p>and maybe your environment looks like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%environment
BEST_GUY=foo
export BEST_GUY
</code></pre>
</div>

<p>but what if you run into this issue, with foo and bar?</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%environment
BEST_GUY=foo
BEST_GUY=bar
export BEST_GUY
</code></pre>
</div>

<p>You obviously can’t have them at separate times. You’d have to source some custom environment file (that you make on your own) and it gets hard easily with issues of using shell and sourcing. We don’t know who the best guy is! You probably get the general idea. Without internal organization and modularity:</p>

<ul>
  <li>You have to do a lot of manual work to expose the different software to the user via a custom runscript (and be a generally decent programmer).</li>
  <li>All software must share the same metadata, environment, and labels.</li>
</ul>

<p>Under these conditions, containers are at best block boxes with unclear delineation between software provided, and only one context of running anything. The container creator shouldn’t need to spend inordinate amounts of time writing custom runscripts to support multiple functions and inputs. Each of <code class="highlighter-rouge">foo</code> and <code class="highlighter-rouge">bar</code> should be easy to define, and have it’s own runscript, environment, labels, tests, and help section.</p>

<h3 id="container-transparency">Container Transparency</h3>
<p>SCI-F Apps make <code class="highlighter-rouge">foo</code> and <code class="highlighter-rouge">bar</code> transparent, and solve this problem of mixed up modules. Our simple issue of mixed up modules could be solved if we could do this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Bootstrap:docker
From: ubuntu:16.04

%appenv foo
BEST_GUY=foo
export BEST_GUY

%appenv bar
BEST_GUY=bar
export BEST_GUY

%apprun foo
echo The best guy is $BEST_GUY

%apprun bar
echo The best guy is $BEST_GUY
</code></pre>
</div>

<p>Generate the container, and run it in the context of <code class="highlighter-rouge">foo</code> and then <code class="highlighter-rouge">bar</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity run --app bar foobar.img 
The best guy is bar
$ singularity run --app foo foobar.img 
The best guy is foo

</code></pre>
</div>

<p>Using SCI-F apps, a user can easily discover both <code class="highlighter-rouge">foo</code> and <code class="highlighter-rouge">bar</code> without knowing anything about the container:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>singularity apps foobar.img
bar
foo
</code></pre>
</div>

<p>and inspect each one:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>singularity inspect --app foo  foobar.img 
{
    "SINGULARITY_APP_NAME": "foo",
    "SINGULARITY_APP_SIZE": "1MB"
}
</code></pre>
</div>

<h3 id="container-modularity">Container Modularity</h3>
<p>What is going on, under the hood? Just a simple, clean organization that is tied to a set of sections in the build recipe relevant to each app. For example, I can specify custom install procedures (and they are relevant to each app’s specific base defined under <code class="highlighter-rouge">/scif/apps</code>), labels, tests, and help sections. Before I tell you about the sections, I’ll briefly show you what the organization looks like, for each app:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/scif/apps/

     foo/
        bin/
        lib/
        scif/
            runscript.help
            runscript
            env/
                01-base.sh 
                90-environment.sh

     bar/

     ....
</code></pre>
</div>

<p>If you are familiar with Singularity, the above will look very familiar. It mirrors the Singularity (main container) metadata folder, except instead of <code class="highlighter-rouge">.singularity.d</code> we have <code class="highlighter-rouge">scif</code>. The name and base <code class="highlighter-rouge">scif</code> is chosen intentionally to be something short, and likely to be unique. On the level of organization and metadata, these internal apps are like little containers! Are you worried that you need to remember all this
path nonsense? Don’t worry, you don’t. You can just use environment variables in your runscripts, etc. Here we are looking at the environment active for lolcat:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>singularity exec --app lolcat scif.img env | grep lolcat

SINGULARITY_APPOUTPUT=/scif/data/lolcat/output
BEST_APP=lolcat
LD_LIBRARY_PATH=/scif/apps/lolcat/lib:/.singularity.d/libs
APPDATA_lolcat=/scif/data/lolcat
SINGULARITY_APPDATA=/scif/data/lolcat
PATH=/scif/apps/lolcat/bin:/scif/apps/lolcat:/usr/games:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
SINGULARITY_APPINPUT=/scif/data/lolcat/input
APPROOT_lolcat=/scif/apps/lolcat
SINGULARITY_APPROOT=/scif/apps/lolcat
SINGULARITY_APPNAME=lolcat
SINGULARITY_APPMETA=/scif/apps/lolcat/scif
</code></pre>
</div>

<p>Notice a few things!</p>

<ul>
  <li>the specific environment (<code class="highlighter-rouge">%appenv lolcat</code>) is active because <code class="highlighter-rouge">BEST_APP</code> is lolcat</li>
  <li>the lib folder in lolcat’s base is added to the LD_LIBRARY_PATH</li>
  <li>the bin folder is added to the path</li>
  <li>locations for input, output, and general data are exposed. It’s up to you how you use these, but you can predictably know that a well made app will look for inputs and outputs in it’s specific folder.</li>
  <li>environment variables are provided for the app’s root, it’s data, and it’s name</li>
</ul>

<p>If you need to interact with other app’s during the execution of an app, the base and data folders are provided too (note I filtered this list to show the relevant):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>singularity exec --app lolcat scif.img env | grep APP

APPDATA_cowsay=/scif/data/cowsay
APPROOT_cowsay=/scif/apps/cowsay

APPROOT_lolcat=/scif/apps/lolcat
APPDATA_lolcat=/scif/data/lolcat

APPDATA_fortune=/scif/data/fortune
APPROOT_fortune=/scif/apps/fortune
</code></pre>
</div>

<p>Also provided are more global paths for data and apps:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SINGULARITY_APPS=/scif/apps
SINGULARITY_DATA=/scif/data
</code></pre>
</div>

<p>Importantly, each app has its own modular location. When you do an <code class="highlighter-rouge">%appinstall foo</code>, the commands are all done in context of that base. The bin and lib are also automatically generated. So what would be a super simple app? Just add a script and name it:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%appfiles foo
runfoo.sh   bin/runfoo.sh
</code></pre>
</div>

<p>and then maybe for install I’d make it executable</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%appinstall foo
chmod u+x bin/runfoo.sh
</code></pre>
</div>

<p>You don’t even need files! You could just do this.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%appinstall foo
echo 'echo "Hello Foo."' &gt;&gt; bin/runfoo.sh
chmod u+x bin/runfoo.sh
</code></pre>
</div>

<p>Finding the section <code class="highlighter-rouge">%appinstall</code>, <code class="highlighter-rouge">%apphelp</code>, or <code class="highlighter-rouge">%apprun</code> is indication of an application command. The following string is parsed as the name of the application, and this folder is created, in lowercase, under <code class="highlighter-rouge">/scif/apps</code> if it doesn’t exist.  A singularity metadata folder, .singularity.d, equivalent to the container’s main folder, is generated inside the application. An application thus is like a smaller image inside of it’s parent.</p>

<p>Specifically, SCI-F defines the following new sections for the build recipe, where each is optional for 0 or more apps:</p>

<p><strong>%appinstall</strong> 
corresponds to executing commands within the folder to install the  application. These commands would previously belong in %post, but are now attributable 
to the application.</p>

<p><strong>%apphelp</strong>
is written as a file called runscript.help in the application’s metadata folder,  where the Singularity software knows where to find it. If no help section is provided, the 
software simply will alert the user and show the files provided for inspection.</p>

<p><strong>%apprun</strong> 
is also written as a file called runscript.exec in the application’s metadata 
folder, and again looked for when the user asks to run the software. If not found, the container should default to shelling into that location.</p>

<p><strong>%applabels</strong>
 will write a labels.json in the application’s metadata  folder, allowing for application specific labels.</p>

<p><strong>%appenv</strong>
will write an environment file in the application’s base folder, allowing for definition of application specific environment variables.</p>

<p><strong>%apptest</strong>
will run tests specific to the application, with present working directory assumed to be the software module’s folder</p>

<p><strong>%appfiles</strong>
will add files to the app’s base at <code class="highlighter-rouge">/scif/apps/&lt;app&gt;</code></p>

<p>Singularity containers are already reproducible in that they package dependencies. This basic format adds to that by making the software inside of them modular, predictable, and programmatically accessible. We can say confidently that some set of steps, labels, or variables in the runscript is associated with a particular action of the container. We can better reveal how dependencies relate to each step in a scientific workflow.  Making containers is not easy. When a scientist starts to write a recipe for his set of tools, he probably doesn’t know where to put it, perhaps that a help file should exist, or that metadata about the software should be served by the container. If container generation software made it easy to organize and capture container content automatically, we would easily meet these goals of internal modularity and consistency, and generate containers that easily integrate with external hosts, data, and other containers. These are essential components for (ultimately) optimizing the way we develop, understand, and execute our scientific containers.</p>

<h2 id="cowsay-container">Cowsay Container</h2>
<p>Now let’s go through the tutorial to build our <a href="https://github.com/singularityware/singularity/blob/development/examples/apps/Singularity.cowsay" target="_blank">cowsay container.</a></p>

<p><strong>Important!</strong> This tutorial is for Singularity 2.4, which is still under the development branch. You need to clone development and install it first before using the build command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git clone -b development https://www.github.com/singularityware/singularity.git
cd singularity
./autogen.sh
./configure --prefix=/usr/local
make
sudo make install
</code></pre>
</div>

<p>When you’ve installed 2.4, download the recipe, and save it to your present working directory. By the way, credit for anything and everything lolcat and cowsay goes to <a href="https://www.github.com/GodLoveD" target="_blank">@GodLoveD</a>! Here is the recipe:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>wget https://raw.githubusercontent.com/singularityware/singularity/development/examples/apps/Singularity.cowsay
sudo singularity build moo.img Singularity.cowsay
</code></pre>
</div>
<p>Note that when development is merged into master, you may need to change “development”  in the address above to master.</p>

<p>What apps are installed?</p>

<div class="highlighter-rouge"><pre class="highlight"><code>singularity apps moo.img
cowsay
fortune
lolcat
</code></pre>
</div>

<p>Ask for help for a specific app!</p>

<div class="highlighter-rouge"><pre class="highlight"><code>singularity help --app fortune moo.img
fortune is the best app
</code></pre>
</div>

<p>Ask for help for all apps, without knowing in advance what they are:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>for app in $(singularity apps moo.img)
   do
     singularity help --app $app moo.img
done
cowsay is the best app
fortune is the best app
lolcat is the best app
</code></pre>
</div>

<p>Run a particular app</p>

<div class="highlighter-rouge"><pre class="highlight"><code>singularity run --app fortune moo.img
	My dear People.
	My dear Bagginses and Boffins, and my dear Tooks and Brandybucks,
and Grubbs, and Chubbs, and Burrowses, and Hornblowers, and Bolgers,
Bracegirdles, Goodbodies, Brockhouses and Proudfoots.  Also my good
Sackville Bagginses that I welcome back at last to Bag End.  Today is my
one hundred and eleventh birthday: I am eleventy-one today!"
		-- J. R. R. Tolkien

</code></pre>
</div>

<p>Advanced running - pipe the output of fortune into lolcat, and make a fortune
that is beautifully colored!</p>

<div class="highlighter-rouge"><pre class="highlight"><code>singularity run --app fortune moo.img | singularity run --app lolcat moo.img
You will be surrounded by luxury.
</code></pre>
</div>

<p>This one might be easier to see - pipe the same fortune into the cowsay app:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>singularity run --app fortune moo.img | singularity run --app cowsay moo.img
 ________________________________________
/ Executive ability is prominent in your \
\ make-up.                               /
 ----------------------------------------
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||
</code></pre>
</div>

<p>and the final shabang - do the same, but make it colored. Let’s even get lazy and use
an evironment variable for the command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CMD="singularity run --app"
$CMD fortune moo.img | $CMD cowsay moo.img | $CMD lolcat moo.img
 _________________________________________
/ Ships are safe in harbor, but they were \
\ never meant to stay there.              /
 -----------------------------------------
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||

</code></pre>
</div>

<p>Yes, you need to watch the asciinema to see the colors. Finally, inspect an app:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> singularity inspect --app fortune moo.img 
{
    "SINGULARITY_APP_NAME": "fortune",
    "SINGULARITY_APP_SIZE": "1MB"
}
</code></pre>
</div>

<p>If you haven’t yet, <a href="https://asciinema.org/a/139153?speed=3" target="_blank">take a look at these examples</a> with the asciinema!</p>


    <!-- More navigation on the bottom -->
    <div class="row" style="padding-top:30px; margin-bottom:10px"><div class="col-md-12">
        <a href="#"><button style="width:20%; height: 70px; float:left" class="hidden previous-button btn btn-lg btn-default">Previous</button></a>
        <a href="#"><button style="width:20%; height: 70px; float:right" class="hidden next-button btn btn-lg btn-default">Next</button></a>
    </div></div>


    

    

    <a style="margin-top:10px;margin-bottom:10px" target="_blank" href="https://github.com/singularityware/singularityware.github.io/blob/master/pages/_pages/docs/docs-scif-apps.md" class="btn btn-default btn-xs githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>
    

    

    <div class="tags">
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">

               <!-- Social Media links, etc -->
               <div class="col-lg-6 footer">
               
    <a class="no-after social-icon" href="https://twitter.com/SingularityApp">
      <i class="fa fa-4x fa-twitter no-after"></i>
    </a>


    <a class="no-after social-icon" href="https://github.com/singularityware">
      <i class="fa fa-4x fa-github no-after"></i>
    </a>



               </div>

                <div class="col-lg-6 footer">
<p><img src="images/logo/logo.png" alt="Company logo" style="width:40px;padding-bottom:10px"/></p>
 Site last generated: Oct 12, 2017 <br />
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-84672381-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


</html>
