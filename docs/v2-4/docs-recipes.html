<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="description" content="   The Singularity Recipe   These docs are for Singularity Version 2.4. For older versions, see our archive                                         A Singularity Recipe is the driver of a custom build, and the starting point for designing any custom container. It includes specifics about installation software, environment variables, files to add, and container metadata. You can even write a help section, or define modular components in the container called  based on the Standard Container Integration Format (SCI-F).OverviewA Singularity Recipe file is divided into several parts:  Header: The Header describes the core operating system to build within the container. Here you will configure the base operating system features that you need within your container. Examples of this include, what distribution of Linux, what version, what packages must be part of a core install.  Sections: The rest of the definition is comprised of sections, sometimes called scriptlets or blobs of data. Each section is defined by a % character followed by the name of the particular section. All sections are optional.Please see the examples directory in the Singularity source code for some ideas on how to get started.HeaderThe header is at the top of the file, and tells Singularity the base Operating System that it should use to build the container.  It is composed of several keywords. Specifically:  Bootstrap: references the kind of base you want to use (e.g., docker, debootstrap, shub). For example, a shub bootstrap will pull containers for shub as bases. A Docker bootstrap will pull docker layers to start your image. For a full list see build  From: is the named container (shub) or reference to layers (Docker) that you want to use (e.g., vsoch/hello-world)Depending on the value assigned to Bootstrap:, other keywords may also be valid in the header.For example, a very minimal Singularity Hub build might look like this:Bootstrap: shubFrom: vsoch/hello-worldA build that uses a mirror to install Centos-7 might look like this:Bootstrap: yumOSVersion: 7MirrorURL: http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/$basearch/Include: yumEach build base requires particular details during build time.  You can read about them and see examples at the following links:  shub (images hosted on Singularity Hub)  docker (images hosted on Docker Hub)  localimage (images saved on your machine)  yum (yum based systems such as CentOS and Scientific Linux)  debootstrap (apt based systems such as Debian and Ubuntu)  arch (Arch Linux)  busybox (BusyBox)  zypper (zypper based systems such as Suse and OpenSuse)SectionsThe main content of the bootstrap file is broken into sections. Different sections add different content or execute commands at different times during the build process.  Note that if any command fails, the build process will halt.Let’s add each section to our container to see how it works. For each section, we will build the container from the recipe (a file called Singularity) as follows:$ sudo singularity build roar.simg Singularity%helpYou don’t need to do much programming to add a %help section to your container. Just write it into a section:Bootstrap: dockerFrom: ubuntu%helpHelp me. I'm in the container.And it will work when the user asks the container for help.$ singularity help roar.simg Help me. I'm in the container.%setupCommands in the %setup section are executed on the host system outside of the container after the base OS has been installed.  For versions earlier than 2.3, or if you need files during %post, you should copy files from your host to $SINGULARITY_ROOTFS to move them into the container. For &gt;2.3 and cases when you don’t need the files until after %post, we recommend you use %files section. We can see the difference between %setup and %post in the following asciicast:Show Video Tutorial        In the above, we see that copying something to $SINGULARITY_ROOTFS during %setup was successful to move the file into the container, but copying during %post was not. Let’s add a setup to our current container, just writing a file to the root of the image:Bootstrap: dockerFrom: ubuntu%helpHelp me. I'm in the container.%setup    touch ${SINGULARITY_ROOTFS}/tacos.txt    touch avocados.txtImportantly, notice that the avocados file isn’t relative to $SINGULARITY_ROOTFS, so we would expect it not to be in the image. Is tacos there?$ singularity exec roar.simg ls /bin   environment  lib	  mnt	root  scif	   sys	      usrboot  etc	   lib64  opt	run   singularity  **tacos.txt**  vardev   home	   media  proc	sbin  srv	   tmpYes! And avocados.txt isn’t inside the image, but in our present working directory:$ lsavocados.txt   roar.simg   Singularity%filesIf you want to copy files from your host system into the container, you should do so using the %files section.  Each line is a pair of &lt;source&gt; and &lt;destination&gt;, where the source is a path on your host system, and the destination is a path in the container.The %files section uses the traditional cp command, so the same conventions apply.Files are copied after any %post or installation procedures, so if you need the copied files or directories to exist during %post you must do this via %setup. Let’s add the avocado.txt into the container, to join tacos.txt.Bootstrap: dockerFrom: ubuntu%helpHelp me. I'm in the container.%setup    touch ${SINGULARITY_ROOTFS}/tacos.txt    touch avocados.txt%filesavocados.txtavocados.txt /optNotice that I’m adding the same file to two different places. For the first, I’m adding the single file to the root of the image. For the second, I’m adding it to opt. Does it work?$ singularity exec roar.simg ls / singularity exec roar.simg ls /**avocados.txt**  dev	   home   media  proc  sbin	    srv        tmpbin	      environment  lib	  mnt	 root  scif	    sys        usrboot	      etc	   lib64  opt	 run   singularity  **tacos.txt**  var$ singularity exec roar.simg ls /opt**avocados.txt**We have avocados!%labelsTo store metadata with your container, you can add them to the %labels section. They will be stored in the file /.singularity.d/labels.json as metadata within your container. The general format is a LABELNAME followed by a LABELVALUE. Labels from Docker bootstraps will be carried forward here. Let’s add to our example:Bootstrap: dockerFrom: ubuntu%helpHelp me. I'm in the container.%setup    touch ${SINGULARITY_ROOTFS}/tacos.txt    touch avocados.txt%filesavocados.txtavocados.txt /opt    %labelsMaintainer VanessasaurusVersion v1.0The easiest way to see labels is to inspect the image:$ singularity inspect roar.simg{    "org.label-schema.usage.singularity.deffile.bootstrap": "docker",    "MAINTAINER": "Vanessasaurus",    "org.label-schema.usage.singularity.deffile": "Singularity",    "org.label-schema.usage": "/.singularity.d/runscript.help",    "org.label-schema.schema-version": "1.0",    "VERSION": "v1.0",    "org.label-schema.usage.singularity.deffile.from": "ubuntu",    "org.label-schema.build-date": "2017-10-02T17:00:23-07:00",    "org.label-schema.usage.singularity.runscript.help": "/.singularity.d/runscript.help",    "org.label-schema.usage.singularity.version": "2.3.9-development.g3dafa39",    "org.label-schema.build-size": "1760MB"}You’ll notice some other labels that are captured automatically from the build process. You can read more about labels and metadata here.%environmentAs of Singularity 2.3, you can add environment variables to be sourced when the container is used in the %environment section. The entire section is written to a file that gets sourced, so you should generally use the same conventions that you might use in a bashrc or profile.Bootstrap: dockerFrom: ubuntu%helpHelp me. I'm in the container.%setup    touch ${SINGULARITY_ROOTFS}/tacos.txt    touch avocados.txt%filesavocados.txtavocados.txt /opt    %labelsMaintainer VanessasaurusVersion v1.0%environment    VADER=badguy    LUKE=goodguy    SOLO=someguy    export VADER LUKE SOLOYou can easily see environment variables also with inspect:$ singularity inspect -e roar.simg # Custom environment shell code should follow    VADER=badguy    LUKE=goodguy    SOLO=someguy    export VADER LUKE SOLOor in the case of variables generated at build time, you can add environment variables to your container in the %post section (see below) using the following syntax:%post    echo 'export JAWA_SEZ=wutini' &gt;&gt; $SINGULARITY_ENVIRONMENTWhen we rebuild, is it added to the environment?singularity exec roar.simg env | grep JAWAJAWA_SEZ=wutiniWhere are all these environment variables going? Inside the container is a metadata folder located at /.singularity.d, and a subdirectory env for environment scripts that are sourced. Text in the %environment section is appended to a file called /.singularity.d/env/90-environment.sh.  Text redirected to the $SINGULARITY_ENVIRONMENT variable will added to a file called /.singularity.d/env/91-environment.sh.  At runtime, scripts in /.singularity/env are sourced in order. This means that variables in $SINGULARITY_ENVIRONMENT take precedence over those added via %environment. Note that you won’t see these variables in the inspect output, as inspect only shows the contents added from %environment.See Environment and Metadata for more information about the %labels and %environment sections.%postCommands in the %post section are executed within the container after the base OS has been installed at build time. This is where the meat of your setup will live, including making directories, and installing software and libraries. We will jump from our simple use case to show a more realistic scientific container. Here we are installing yum, openMPI, and other dependencies for a Centos7 bootstrap:%post    echo "Installing Development Tools YUM group"    yum -y groupinstall "Development Tools"    echo "Installing OpenMPI into container..."    # Here we are at the base, /, of the container    git clone https://github.com/open-mpi/ompi.git    # Now at /ompi    cd ompi    ./autogen.pl    ./configure --prefix=/usr/local    make    make install    /usr/local/bin/mpicc examples/ring_c.c -o /usr/bin/mpi_ringYou cannot copy files from the host to your container in this section, but you can of course download with commands like git clone and wget and curl.%runscriptThe %runscript is another scriptlet, but it does not get executed during bootstrapping. Instead it gets persisted within the container to a file (or symlink for later versions) called /singularity which is the execution driver when the container image is run (either via the singularity run command or via executing the container directly).When the %runscript is executed, all options are passed along to the executing script at runtime, this means that you can (and should) manage argument processing from within your runscript. Here is an example of how to do that, adding to our work in progress:Bootstrap: dockerFrom: ubuntu%helpHelp me. I'm in the container.%setup    touch ${SINGULARITY_ROOTFS}/tacos.txt    touch avocados.txt%filesavocados.txtavocados.txt /opt    %labelsMaintainer VanessasaurusVersion v1.0%environment    VADER=badguy    LUKE=goodguy    SOLO=someguy    export VADER LUKE SOLO%post    echo 'export JAWA_SEZ=wutini' &gt;&gt; $SINGULARITY_ENVIRONMENT%runscript    echo "Rooooar!"    echo "Arguments received: $*"    exec echo "$@"In this particular runscript, the arguments are printed as a single string ($*) and then they are passed to echo via a quoted array ("$@") which ensures that all of the arguments are properly parsed by the executed command. Using the exec command is like handing off the calling process to the one in the container. The final command (the echo) replaces the current entry in the process table (which originally was the call to Singularity). This makes it so the runscript shell process ceases to exist, and the only process running inside this container is the called echo command. This could easily be another program like python, or an analysis script. Running it, it works as expected:$ singularity run roar.simg Rooooar!Arguments received: $ singularity run roar.simg one twoRooooar!Arguments received: one twoone two%testYou may choose to add a %test section to your definition file. This section will be run at the very end of the build process and will give you a chance to validate the container during the bootstrap process. You can also execute this scriptlet through the container itself, such that you can always test the validity of the container itself as you transport it to different hosts. Extending on the above Open MPI %post, consider this real world example:%test    /usr/local/bin/mpirun --allow-run-as-root /usr/bin/mpi_testThis is a simple Open MPI test to ensure that the MPI is build properly and communicates between processes as it should.If you want to build without running tests (for example, if the test needs to be done in a different environment), you can do so with the --notest argument:$ sudo singularity build --notest mpirun.simg SingularityThis argument is useful in cases where you need hardware that is available during runtime, but is not available on the host that is building the image.AppsWhat if you want to build a single contianer with two or three different apps that each have thier own runscripts and custom environments? In some circumstances, it may be redundant to build different containers for each app with almost equivalent dependencies.Starting in Singularity 2.4 all of the above commands can also be used in the context of internal modules called apps based on the Standard Container Integration Format. For details on apps, see the apps documentation. For a quick rundown of adding an app to your container, here is an example runscript:Bootstrap: dockerFrom: ubuntu%environment    VADER=badguy    LUKE=goodguy    SOLO=someguy    export VADER LUKE SOLO%labels   Maintainer Vanessasaur############################### foo##############################%apprun foo    exec echo "RUNNING FOO"%applabels foo   BESTAPP=FOO   export BESTAPP%appinstall foo   touch foo.exec%appenv foo    SOFTWARE=foo    export SOFTWARE%apphelp foo    This is the help for foo.%appfiles foo   avocados.txt############################### bar##############################%apphelp bar    This is the help for bar.%applabels bar   BESTAPP=BAR   export BESTAPP%appinstall bar    touch bar.exec%appenv bar    SOFTWARE=bar    export SOFTWAREImportantly, note that the apps can exist alongside any and all of the primary sections (e.g. %post or %runscript), and the new %appinstall section is the equivalent of %post but for an app. The title sections (######) aren’t necessary or required, they are just comments to show you the different apps. The ordering isn’t important either, you can have any mixture of sections anywhere in the file after the header. The primary difference is now the container can perform any of it’s primary functions in the context of an app:What apps are installed in the container?$ singularity apps roar.simg barfooHelp me with bar!$ singularity help --app bar roar.simgThis is the help for bar.Run foosingularity run --app foo roar.simg RUNNING FOOShow me the custom environmentsRemember how we defined the same environment variable, SOFTWARE for each of foo and bar? We can execute a command to search the list of active environment variables with grep to see if the variable changes depending on the app we specify:$ singularity exec --app foo roar.simg env | grep SOFTWARESOFTWARE=foo$ singularity exec --app bar roar.simg env | grep SOFTWARESOFTWARE=barExamplesFor more examples, for real world scientific recipes we recommend you look at other containers on Singularity Hub. For examples of different bases, look at the examples folder for the most up-to-date examples. For apps, including snippets and tutorial with more walk throughts, see SCI-F Apps Home.Best Practices for Build RecipesWhen crafting your recipe, it is best to consider the following:  To make your container internally modular, use SCI-F apps. Shared dependencies (between app modules) can go under %post.  For global installs to %post, install packages, programs, data, and files into operating system locations (e.g. not /home, /tmp, or any other directories that might get commonly binded on).  Make your container speak for itself. If your runscript doesn’t spit out help, write a %help or %apphelp section. A good container tells the user how to interact with it.  If you require any special environment variables to be defined, add them the %environment and %appenv sections of the build recipe.  Files should never be owned by actual users, they should always be owned by a system account (UID less than 500).  Ensure that the container’s /etc/passwd, /etc/group, /etc/shadow, and no other sensitive files have anything but the bare essentials within them.  It is encouraged to build containers from a recipe instead of a sandbox that has been manually changed. This ensures greatest possibility of reproducibility and mitigates the black box effect.Are you a recipe pro and now ready to build? Take a look at the build documentation.                Previous        Next                 Edit me                                                                                                                                                 Site last generated: Oct 12, 2017                             ">


<meta name="name" content="The Singularity Recipe">

<meta name="thumbnail" content="http://singularity.lbl.gov/images/logo/logo.svg">




<title>The Singularity Recipe | Singularity</title>
<link rel="stylesheet" href="assets/css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="assets/css/modern-business.css">
<link rel="stylesheet" href="assets/css/lavish-bootstrap.css">
<link rel="stylesheet" href="assets/css/customstyles.css">
<link rel="stylesheet" href="assets/css/theme-blue.css">

<link rel="stylesheet" type="text/css" href="assets/css/asciinema-player.css" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="assets/js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="assets/js/toc.js"></script>
<script src="assets/js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4005feed.xml">

    <script>
        $(document).ready(function() {

            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- asciinema player -->
<script src="assets/js/asciinema-player.js"></script>

<!-- Show or hide players on button clicks-->
<script>
$( document ).ready(function() {
    $(".asciinema-button").click(function(){
        console.log('rawwwr!')
        var asciinemaVideo = "#" + $(this).attr('data-id');
        if ($(asciinemaVideo).hasClass('hidden')){
            $(asciinemaVideo).removeClass('hidden');
            $(this).text('Hide Tutorial')
        } else {
            $(asciinemaVideo).addClass('hidden');
            $(this).text('Show Tutorial')
        }
        
    });
});
</script>

<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Singularity</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="blog">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Docs<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="admin-guide">Admin Guide</a></li>
                        
                        
                        
                        <li><a href="user-guide">User Guide</a></li>
                        
                        
                        
                        <li><a href="archive">Archive</a></li>
                        
                        
                        
                        <li><a href="links">Contributed Content</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Quick Links<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/singularityware/singularity" target="_blank">Github Repo</a></li>
                        
                        
                        
                        <li><a href="https://groups.google.com/a/lbl.gov/forum/#!forum/singularity" target="_blank">Google Group</a></li>
                        
                        
                        
                        <li><a href="http://stackoverflow.com/questions/tagged/singularity" target="_blank">Singularity on Stack Overflow</a></li>
                        
                        
                        
                        <li><a href="https://singularity-hub.org/faq" target="_blank">Singularity Hub</a></li>
                        
                        
                        
                        <li><a href="https://singularity-container.slack.com" target="_blank">Slack</a></li>
                        
                        
                        
                        <li><a href="faq#troubleshooting">Troubleshooting</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">People<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/gmkurtzer" target="_blank">Gregory M. Kurtzer</a></li>
                        
                        
                        
                        <li><a href="https://github.com/vsoch" target="_blank">Vanessa Sochat</a></li>
                        
                        
                        
                        <li><a href="https://github.com/bauerm97" target="_blank">Michael Bauer</a></li>
                        
                        
                        
                        <li><a href="https://github.com/bbockelm" target="_blank">Brian Bockelman</a></li>
                        
                        
                        
                        <li><a href="https://github.com/singularityware/singularity/blob/master/AUTHORS.md" target="_blank">Complete Authors List</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <li><a href="/search"><i class="fa fa-search"></i></li>
                <!-- jekyll search hidden in favor of google
                <li>
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="assets/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="The Singularity Recipe">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">
          






<ul id="mysidebar" class="nav">

    
    <div class="shiny"><a href="\"><figure><img src="/images/logo/logo.svg" class="sidebar-logo"/></figure></a></div>
    

    <li class="sidebarTitle">User Guide</li>
    
    
    
    <li>
        <a href="#">Getting Started</a>
        <ul>
            
            
            
            <li><a href="user-guide">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="docs-installation">Installation</a></li>
            
            
            
            
            
            
            <li><a href="quickstart">Quick Start</a></li>
            
            
            
            
            
            
            <li><a href="docs-build-container">Build a Container</a></li>
            
            
            
            
            
            
            <li class="active"><a href="docs-recipes">Container Recipes</a></li>
            
            
            
            
            
            
            <li><a href="docs-flow">Singularity Flow</a></li>
            
            
            
            
            
            
            <li><a href="docs-mount">Bind Paths and Mounts</a></li>
            
            
            
            
            
            
            <li><a href="docs-overlay">Persistent Overlays</a></li>
            
            
            
            
            
            
            <li><a href="docs-instances">Running Services</a></li>
            
            
            
            
            
            
            <li><a href="docs-user-checks">Container Checks</a></li>
            
            
            
            
            
            
            <li><a href="docs-environment-metadata">Environment and Metadata</a></li>
            
            
            
            
            
            
            <li><a href="docs-scif-apps">Reproducible SCI-F Apps</a></li>
            
            
            
            
            
            
            <li><a href="docs-docker">Singularity and Docker</a></li>
            
            
            
            
            
            
            <li><a href="faq#troubleshooting">Troubleshooting</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Commands</a>
        <ul>
            
            
            
            <li><a href="docs-usage">Command Usage</a></li>
            
            
            
            
            
            
            <li><a href="docs-build">build</a></li>
            
            
            
            
            
            
            <li><a href="docs-exec">exec</a></li>
            
            
            
            
            
            
            <li><a href="docs-inspect">inspect</a></li>
            
            
            
            
            
            
            <li><a href="docs-pull">pull</a></li>
            
            
            
            
            
            
            <li><a href="docs-run">run</a></li>
            
            
            
            
            
            
            <li><a href="docs-shell">shell</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Image Command Group</a>
        <ul>
            
            
            
            <li><a href="docs-export">image.export</a></li>
            
            
            
            
            
            
            <li><a href="docs-expand">image.expand</a></li>
            
            
            
            
            
            
            <li><a href="docs-import">image.import</a></li>
            
            
            
            
            
            
            <li><a href="docs-create">image.create</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Instance Command Group</a>
        <ul>
            
            
            
            <li><a href="docs-instance-start">instance.start</a></li>
            
            
            
            
            
            
            <li><a href="docs-instance-list">instance.list</a></li>
            
            
            
            
            
            
            <li><a href="docs-instance-stop">instance.stop</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Deprecated</a>
        <ul>
            
            
            
            <li><a href="docs-bootstrap">bootstrap</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main">The Singularity Recipe</h1>
   <small style="color: #666; margin-top:50px; font-variant:italic">These docs are for Singularity Version 2.4. For older versions, see our <a class="no-after" 
                                                               href="https://singularityware.github.io/archive">archive</a></small>
</div>



<div class="post-content">

   

    <!-- Previous and next buttons-->
    <div class="row" style="padding-top:30px; margin-bottom:10px"><div class="col-md-12">
        <a href="#"><button style="float:left" class="hidden previous-button btn btn-circle btn-default"><i class="fa-2x fa fa-angle-double-left"></i></button></a>
        <a href="#"><button style="float:right" class="hidden next-button btn btn-circle btn-default"><i class="fa fa-angle-double-right fa-2x"></i></button></a>
    </div></div>

    <script>
    $(document).ready(function(){

        var next = $("li.active").next().last().find('a').attr('href');
        var previous = $("li.active").prev().last().find('a').attr('href');

        // NEXT BUTTON
        if (typeof next == 'undefined'){
            console.log("disabling next button")
            $(".next-button").addClass("hidden")
        } else if (next == "#") {
            next = $("li.active").next().find("li").first().find('a').attr('href');
            $(".next-button").closest('a').attr('href', next)
            $(".next-button").removeClass('hidden')
        } else {
            $(".next-button").closest('a').attr('href', next)
            $(".next-button").removeClass('hidden')
        }

        // PREVIOUS BUTTON
        if (typeof previous == 'undefined'){
            console.log("disabling previous button")
            $(".previous-button").addClass("hidden")
        } else if (previous == "#") {
            previous = $("li.active").prev().find("li").last().find('a').attr('href')
            $(".previous-button").closest('a').attr('href', previous)
            $(".previous-button").removeClass('hidden')
        } else {
            $(".previous-button").closest('a').attr('href', previous)
            $(".previous-button").removeClass('hidden')
        }

    })
    </script>

    

  <p>A Singularity Recipe is the driver of a custom build, and the starting point for designing any custom container. It includes specifics about installation software, environment variables, files to add, and container metadata. You can even write a help section, or define modular components in the container called <a href="/apps"></a> based on the <a href="https://containers-ftw.github.io/SCI-F/" target="_blank">Standard Container Integration Format (SCI-F)</a>.</p>

<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

<h2 id="overview">Overview</h2>

<p>A Singularity Recipe file is divided into several parts:</p>

<ol>
  <li><strong>Header</strong>: The Header describes the core operating system to build within the container. Here you will configure the base operating system features that you need within your container. Examples of this include, what distribution of Linux, what version, what packages must be part of a core install.</li>
  <li><strong>Sections</strong>: The rest of the definition is comprised of sections, sometimes called scriptlets or blobs of data. Each section is defined by a <code class="highlighter-rouge">%</code> character followed by the name of the particular section. All sections are optional.</li>
</ol>

<p>Please see the <a href="https://github.com/singularityware/singularity/tree/master/examples">examples</a> directory in the <a href="https://github.com/singularityware/singularity">Singularity source code</a> for some ideas on how to get started.</p>

<h3 id="header">Header</h3>
<p>The header is at the top of the file, and tells Singularity the base Operating System that it should use to build the container.  It is composed of several keywords. Specifically:</p>

<ul>
  <li><code class="highlighter-rouge">Bootstrap:</code> references the kind of base you want to use (e.g., docker, debootstrap, shub). For example, a shub bootstrap will pull containers for shub as bases. A Docker bootstrap will pull docker layers to start your image. For a full list see <a href="docs-build-container">build</a></li>
  <li><code class="highlighter-rouge">From:</code> is the named container (shub) or reference to layers (Docker) that you want to use (e.g., vsoch/hello-world)</li>
</ul>

<p>Depending on the value assigned to <code class="highlighter-rouge">Bootstrap:</code>, other keywords may also be valid in the header.</p>

<p>For example, a very minimal Singularity Hub build might look like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Bootstrap: shub
From: vsoch/hello-world
</code></pre>
</div>

<p>A build that uses a mirror to install Centos-7 might look like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Bootstrap: yum
OSVersion: 7
MirrorURL: http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/$basearch/
Include: yum
</code></pre>
</div>

<p>Each build base requires particular details during build time.  You can read about them and see examples at the following links:</p>

<ul>
  <li><a href="/build-shub">shub</a> (images hosted on Singularity Hub)</li>
  <li><a href="/build-docker-module">docker</a> (images hosted on Docker Hub)</li>
  <li><a href="/build-localimage">localimage</a> (images saved on your machine)</li>
  <li><a href="/build-yum">yum</a> (yum based systems such as CentOS and Scientific Linux)</li>
  <li><a href="/build-debootstrap">debootstrap</a> (apt based systems such as Debian and Ubuntu)</li>
  <li><a href="/build-arch">arch</a> (Arch Linux)</li>
  <li><a href="/build-busybox">busybox</a> (BusyBox)</li>
  <li><a href="/build-zypper">zypper</a> (zypper based systems such as Suse and OpenSuse)</li>
</ul>

<h3 id="sections">Sections</h3>
<p>The main content of the bootstrap file is broken into sections. Different sections add different content or execute commands at different times during the build process.  Note that if any command fails, the build process will halt.</p>

<p>Let’s add each section to our container to see how it works. For each section, we will build the container from the recipe (a file called Singularity) as follows:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity build roar.simg Singularity
</code></pre>
</div>

<h4 id="help">%help</h4>
<p>You don’t need to do much programming to add a <code class="highlighter-rouge">%help</code> section to your container. Just write it into a section:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Bootstrap: docker
From: ubuntu

%help
Help me. I'm in the container.
</code></pre>
</div>

<p>And it will work when the user asks the container for help.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity help roar.simg 

Help me. I'm in the container.
</code></pre>
</div>

<h4 id="setup">%setup</h4>
<p>Commands in the <code class="highlighter-rouge">%setup</code> section are executed on the host system outside of the container after the base OS has been installed.  For versions earlier than 2.3, or if you need files during <code class="highlighter-rouge">%post</code>, you should copy files from your host to <code class="highlighter-rouge">$SINGULARITY_ROOTFS</code> to move them into the container. For &gt;2.3 and cases when you don’t need the files until after <code class="highlighter-rouge">%post</code>, we recommend you use <code class="highlighter-rouge">%files</code> section. We can see the difference between <code class="highlighter-rouge">%setup</code> and <code class="highlighter-rouge">%post</code> in the following asciicast:</p>

<p><button style="color:white;margin-top:5px" class="btn btn-primary btn-lg asciinema-button" data-id="asciinema-container-setup-vs-post">Show Video Tutorial</button></p>
<div class="hidden" id="asciinema-container-setup-vs-post">
    <asciinema-player src="assets/asciicast/docs-bootstrap-setup-vs-post.json" poster="data:text/plain,How does the container see setup vs post?" title="How does the container see setup vs post?" author="vsochat@stanford.edu" cols="115" rows="25" speed="2.0" theme="asciinema">
    </asciinema-player>
</div>

<p>In the above, we see that copying something to <code class="highlighter-rouge">$SINGULARITY_ROOTFS</code> during <code class="highlighter-rouge">%setup</code> was successful to move the file into the container, but copying during <code class="highlighter-rouge">%post</code> was not. Let’s add a setup to our current container, just writing a file to the root of the image:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Bootstrap: docker
From: ubuntu

%help
Help me. I'm in the container.

%setup
    touch ${SINGULARITY_ROOTFS}/tacos.txt
    touch avocados.txt
</code></pre>
</div>

<p>Importantly, notice that the avocados file isn’t relative to <code class="highlighter-rouge">$SINGULARITY_ROOTFS</code>, so we would expect it not to be in the image. Is tacos there?</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity exec roar.simg ls /
bin   environment  lib	  mnt	root  scif	   sys	      usr
boot  etc	   lib64  opt	run   singularity  **tacos.txt**  var
dev   home	   media  proc	sbin  srv	   tmp
</code></pre>
</div>

<p>Yes! And avocados.txt isn’t inside the image, but in our present working directory:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ls
avocados.txt   roar.simg   Singularity
</code></pre>
</div>

<h4 id="files">%files</h4>
<p>If you want to copy files from your host system into the container, you should do so using the <code class="highlighter-rouge">%files</code> section.  Each line is a pair of <code class="highlighter-rouge">&lt;source&gt;</code> and <code class="highlighter-rouge">&lt;destination&gt;</code>, where the source is a path on your host system, and the destination is a path in the container.</p>

<p>The <code class="highlighter-rouge">%files</code> section uses the traditional <code class="highlighter-rouge">cp</code> command, so the <a href="https://linux.die.net/man/1/cp" target="_blank">same conventions apply</a>.</p>

<p>Files are copied <strong>after</strong> any <code class="highlighter-rouge">%post</code> or installation procedures, so if you need the copied files or directories to exist during <code class="highlighter-rouge">%post</code> you must do this via <code class="highlighter-rouge">%setup</code>. Let’s add the avocado.txt into the container, to join tacos.txt.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Bootstrap: docker
From: ubuntu

%help
Help me. I'm in the container.

%setup
    touch ${SINGULARITY_ROOTFS}/tacos.txt
    touch avocados.txt

%files
avocados.txt
avocados.txt /opt
</code></pre>
</div>
<p>Notice that I’m adding the same file to two different places. For the first, I’m adding the single file to the root of the image. For the second, I’m adding it to opt. Does it work?</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity exec roar.simg ls /
 singularity exec roar.simg ls /
**avocados.txt**  dev	   home   media  proc  sbin	    srv        tmp
bin	      environment  lib	  mnt	 root  scif	    sys        usr
boot	      etc	   lib64  opt	 run   singularity  **tacos.txt**  var

$ singularity exec roar.simg ls /opt
**avocados.txt**

</code></pre>
</div>

<p>We have avocados!</p>

<h4 id="labels">%labels</h4>
<p>To store metadata with your container, you can add them to the <code class="highlighter-rouge">%labels</code> section. They will be stored in the file <code class="highlighter-rouge">/.singularity.d/labels.json</code> as metadata within your container. The general format is a <code class="highlighter-rouge">LABELNAME</code> followed by a <code class="highlighter-rouge">LABELVALUE</code>. Labels from Docker bootstraps will be carried forward here. Let’s add to our example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Bootstrap: docker
From: ubuntu

%help
Help me. I'm in the container.

%setup
    touch ${SINGULARITY_ROOTFS}/tacos.txt
    touch avocados.txt

%files
avocados.txt
avocados.txt /opt    

%labels
Maintainer Vanessasaurus
Version v1.0
</code></pre>
</div>
<p>The easiest way to see labels is to inspect the image:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity inspect roar.simg
{
    "org.label-schema.usage.singularity.deffile.bootstrap": "docker",
    "MAINTAINER": "Vanessasaurus",
    "org.label-schema.usage.singularity.deffile": "Singularity",
    "org.label-schema.usage": "/.singularity.d/runscript.help",
    "org.label-schema.schema-version": "1.0",
    "VERSION": "v1.0",
    "org.label-schema.usage.singularity.deffile.from": "ubuntu",
    "org.label-schema.build-date": "2017-10-02T17:00:23-07:00",
    "org.label-schema.usage.singularity.runscript.help": "/.singularity.d/runscript.help",
    "org.label-schema.usage.singularity.version": "2.3.9-development.g3dafa39",
    "org.label-schema.build-size": "1760MB"
}
</code></pre>
</div>

<p>You’ll notice some other labels that are captured automatically from the build process. You can read more about labels and metadata <a href="/docs-environment-metadata">here</a>.</p>

<h4 id="environment">%environment</h4>
<p>As of Singularity 2.3, you can add environment variables to be sourced when the container is used in the <code class="highlighter-rouge">%environment</code> section. The entire section is written to a file that gets sourced, so you should generally use the same conventions that you might use in a <code class="highlighter-rouge">bashrc</code> or <code class="highlighter-rouge">profile</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Bootstrap: docker
From: ubuntu

%help
Help me. I'm in the container.

%setup
    touch ${SINGULARITY_ROOTFS}/tacos.txt
    touch avocados.txt

%files
avocados.txt
avocados.txt /opt    

%labels
Maintainer Vanessasaurus
Version v1.0

%environment
    VADER=badguy
    LUKE=goodguy
    SOLO=someguy
    export VADER LUKE SOLO
</code></pre>
</div>

<p>You can easily see environment variables also with inspect:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity inspect -e roar.simg # Custom environment shell code should follow

    VADER=badguy
    LUKE=goodguy
    SOLO=someguy
    export VADER LUKE SOLO

</code></pre>
</div>

<p>or in the case of variables generated at build time, you can add environment variables to your container in the <code class="highlighter-rouge">%post</code> section (see below) using the following syntax:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%post
    echo 'export JAWA_SEZ=wutini' &gt;&gt; $SINGULARITY_ENVIRONMENT
</code></pre>
</div>

<p>When we rebuild, is it added to the environment?</p>

<div class="highlighter-rouge"><pre class="highlight"><code>singularity exec roar.simg env | grep JAWA
JAWA_SEZ=wutini
</code></pre>
</div>

<p>Where are all these environment variables going? Inside the container is a metadata folder located at <code class="highlighter-rouge">/.singularity.d</code>, and a subdirectory <code class="highlighter-rouge">env</code> for environment scripts that are sourced. Text in the <code class="highlighter-rouge">%environment</code> section is appended to a file called <code class="highlighter-rouge">/.singularity.d/env/90-environment.sh</code>.  Text redirected to the <code class="highlighter-rouge">$SINGULARITY_ENVIRONMENT</code> variable will added to a file called <code class="highlighter-rouge">/.singularity.d/env/91-environment.sh</code>.  At runtime, scripts in <code class="highlighter-rouge">/.singularity/env</code> are sourced in order. This means that variables in <code class="highlighter-rouge">$SINGULARITY_ENVIRONMENT</code> take precedence over those added via <code class="highlighter-rouge">%environment</code>. Note that you won’t see these variables in the inspect output, as inspect only shows the contents added from <code class="highlighter-rouge">%environment</code>.</p>

<p>See <a href="/docs-environment-metadata">Environment and Metadata</a> for more information about the <code class="highlighter-rouge">%labels</code> and <code class="highlighter-rouge">%environment</code> sections.</p>

<h4 id="post">%post</h4>
<p>Commands in the <code class="highlighter-rouge">%post</code> section are executed within the container after the base OS has been installed at build time. This is where the meat of your setup will live, including making directories, and installing software and libraries. We will jump from our simple use case to show a more realistic scientific container. Here we are installing yum, openMPI, and other dependencies for a Centos7 bootstrap:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%post
    echo "Installing Development Tools YUM group"
    yum -y groupinstall "Development Tools"
    echo "Installing OpenMPI into container..."

    # Here we are at the base, /, of the container
    git clone https://github.com/open-mpi/ompi.git

    # Now at /ompi
    cd ompi
    ./autogen.pl
    ./configure --prefix=/usr/local
    make
    make install

    /usr/local/bin/mpicc examples/ring_c.c -o /usr/bin/mpi_ring
</code></pre>
</div>

<p>You cannot copy files from the host to your container in this section, but you can of course download with commands like <code class="highlighter-rouge">git clone</code> and <code class="highlighter-rouge">wget</code> and <code class="highlighter-rouge">curl</code>.</p>

<h4 id="runscript">%runscript</h4>
<p>The <code class="highlighter-rouge">%runscript</code> is another scriptlet, but it does not get executed during bootstrapping. Instead it gets persisted within the container to a file (or symlink for later versions) called <code class="highlighter-rouge">/singularity</code> which is the execution driver when the container image is <strong><em>run</em></strong> (either via the <code class="highlighter-rouge">singularity run</code> command or via executing the container directly).</p>

<p>When the <code class="highlighter-rouge">%runscript</code> is executed, all options are passed along to the executing script at runtime, this means that you can (and should) manage argument processing from within your runscript. Here is an example of how to do that, adding to our work in progress:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Bootstrap: docker
From: ubuntu

%help
Help me. I'm in the container.

%setup
    touch ${SINGULARITY_ROOTFS}/tacos.txt
    touch avocados.txt

%files
avocados.txt
avocados.txt /opt    

%labels
Maintainer Vanessasaurus
Version v1.0

%environment
    VADER=badguy
    LUKE=goodguy
    SOLO=someguy
    export VADER LUKE SOLO


%post
    echo 'export JAWA_SEZ=wutini' &gt;&gt; $SINGULARITY_ENVIRONMENT

%runscript
    echo "Rooooar!"
    echo "Arguments received: $*"
    exec echo "$@"
</code></pre>
</div>

<p>In this particular runscript, the arguments are printed as a single string (<code class="highlighter-rouge">$*</code>) and then they are passed to <code class="highlighter-rouge">echo</code> via a quoted array (<code class="highlighter-rouge">"$@"</code>) which ensures that all of the arguments are properly parsed by the executed command. Using the <code class="highlighter-rouge">exec</code> command is like handing off the calling process to the one in the container. The final command (the echo) replaces the current entry in the process table (which originally was the call to Singularity). This makes it so the runscript shell process ceases to exist, and the only process running inside this container is the called echo command. This could easily be another program like python, or an analysis script. Running it, it works as expected:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity run roar.simg 
Rooooar!
Arguments received: 

$ singularity run roar.simg one two
Rooooar!
Arguments received: one two
one two
</code></pre>
</div>

<h4 id="test">%test</h4>
<p>You may choose to add a <code class="highlighter-rouge">%test</code> section to your definition file. This section will be run at the very end of the build process and will give you a chance to validate the container during the bootstrap process. You can also execute this scriptlet through the container itself, such that you can always test the validity of the container itself as you transport it to different hosts. Extending on the above Open MPI <code class="highlighter-rouge">%post</code>, consider this real world example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%test
    /usr/local/bin/mpirun --allow-run-as-root /usr/bin/mpi_test
</code></pre>
</div>

<p>This is a simple Open MPI test to ensure that the MPI is build properly and communicates between processes as it should.</p>

<p>If you want to build without running tests (for example, if the test needs to be done in a different environment), you can do so with the <code class="highlighter-rouge">--notest</code> argument:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity build --notest mpirun.simg Singularity
</code></pre>
</div>

<p>This argument is useful in cases where you need hardware that is available during runtime, but is not available on the host that is building the image.</p>

<h2 id="apps">Apps</h2>
<p>What if you want to build a single contianer with two or three different apps that each have thier own runscripts and custom environments? In some circumstances, it may be redundant to build different containers for each app with almost equivalent dependencies.</p>

<p>Starting in Singularity 2.4 all of the above commands can also be used in the context of internal modules called <a href="/docs-apps">apps</a> based on the <a href="http://containers-ftw.org/SCI-F/" target="_blank">Standard Container Integration Format</a>. For details on apps, see the <a href="/docs-apps">apps</a> documentation. For a quick rundown of adding an app to your container, here is an example runscript:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Bootstrap: docker
From: ubuntu

%environment
    VADER=badguy
    LUKE=goodguy
    SOLO=someguy
    export VADER LUKE SOLO

%labels
   Maintainer Vanessasaur

##############################
# foo
##############################

%apprun foo
    exec echo "RUNNING FOO"

%applabels foo
   BESTAPP=FOO
   export BESTAPP

%appinstall foo
   touch foo.exec

%appenv foo
    SOFTWARE=foo
    export SOFTWARE

%apphelp foo
    This is the help for foo.

%appfiles foo
   avocados.txt


##############################
# bar
##############################

%apphelp bar
    This is the help for bar.

%applabels bar
   BESTAPP=BAR
   export BESTAPP

%appinstall bar
    touch bar.exec

%appenv bar
    SOFTWARE=bar
    export SOFTWARE
</code></pre>
</div>

<p>Importantly, note that the apps can exist alongside any and all of the primary sections (e.g. <code class="highlighter-rouge">%post</code> or <code class="highlighter-rouge">%runscript</code>), and the new <code class="highlighter-rouge">%appinstall</code> section is the equivalent of <code class="highlighter-rouge">%post</code> but for an app. The title sections (<code class="highlighter-rouge">######</code>) aren’t necessary or required, they are just comments to show you the different apps. The ordering isn’t important either, you can have any mixture of sections anywhere in the file after the header. The primary difference is now the container can perform any of it’s primary functions in the context of an app:</p>

<p><strong>What apps are installed in the container?</strong></p>
<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity apps roar.simg 
bar
foo
</code></pre>
</div>

<p><strong>Help me with bar!</strong></p>
<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity help --app bar roar.simg
This is the help for bar.
</code></pre>
</div>

<p><strong>Run foo</strong></p>
<div class="highlighter-rouge"><pre class="highlight"><code>singularity run --app foo roar.simg 
RUNNING FOO
</code></pre>
</div>

<p><strong>Show me the custom environments</strong>
Remember how we defined the same environment variable, <code class="highlighter-rouge">SOFTWARE</code> for each of foo and bar? We can execute a command to search the list of active environment variables with grep to see if the variable changes depending on the app we specify:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity exec --app foo roar.simg env | grep SOFTWARE
SOFTWARE=foo
$ singularity exec --app bar roar.simg env | grep SOFTWARE
SOFTWARE=bar
</code></pre>
</div>

<h2 id="examples">Examples</h2>
<p>For more examples, for real world scientific recipes we recommend you look at other containers on <a href="https://singularity-hub.org" target="_blank">Singularity Hub</a>. For examples of different bases, look at the <a href="https://github.com/singularityware/singularity/tree/master/examples" target="_blank">examples</a> folder for the most up-to-date examples. For apps, including snippets and tutorial with more walk throughts, see <a href="http://containers-ftw.org/apps/" target="_blank">SCI-F Apps Home</a>.</p>

<h2 id="best-practices-for-build-recipes">Best Practices for Build Recipes</h2>
<p>When crafting your recipe, it is best to consider the following:</p>

<ol>
  <li>To make your container internally modular, use <a href="/docs-apps">SCI-F apps</a>. Shared dependencies (between app modules) can go under <code class="highlighter-rouge">%post</code>.</li>
  <li>For global installs to <code class="highlighter-rouge">%post</code>, install packages, programs, data, and files into operating system locations (e.g. not <code class="highlighter-rouge">/home</code>, <code class="highlighter-rouge">/tmp</code>, or any other directories that might get commonly binded on).</li>
  <li>Make your container speak for itself. If your runscript doesn’t spit out help, write a <code class="highlighter-rouge">%help</code> or <code class="highlighter-rouge">%apphelp</code> section. A good container tells the user how to interact with it.</li>
  <li>If you require any special environment variables to be defined, add them the <code class="highlighter-rouge">%environment</code> and <code class="highlighter-rouge">%appenv</code> sections of the build recipe.</li>
  <li>Files should never be owned by actual users, they should always be owned by a system account (UID less than 500).</li>
  <li>Ensure that the container’s <code class="highlighter-rouge">/etc/passwd</code>, <code class="highlighter-rouge">/etc/group</code>, <code class="highlighter-rouge">/etc/shadow</code>, and no other sensitive files have anything but the bare essentials within them.</li>
  <li>It is encouraged to build containers from a recipe instead of a sandbox that has been manually changed. This ensures greatest possibility of reproducibility and mitigates the <em>black box effect</em>.</li>
</ol>

<p>Are you a recipe pro and now ready to build? Take a look at the <a href="docs-build-container">build</a> documentation.</p>


    <!-- More navigation on the bottom -->
    <div class="row" style="padding-top:30px; margin-bottom:10px"><div class="col-md-12">
        <a href="#"><button style="width:20%; height: 70px; float:left" class="hidden previous-button btn btn-lg btn-default">Previous</button></a>
        <a href="#"><button style="width:20%; height: 70px; float:right" class="hidden next-button btn btn-lg btn-default">Next</button></a>
    </div></div>


    

    

    <a style="margin-top:10px;margin-bottom:10px" target="_blank" href="https://github.com/singularityware/singularityware.github.io/blob/master/pages/_pages/docs/docs-recipes.md" class="btn btn-default btn-xs githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>
    

    

    <div class="tags">
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">

               <!-- Social Media links, etc -->
               <div class="col-lg-6 footer">
               
    <a class="no-after social-icon" href="https://twitter.com/SingularityApp">
      <i class="fa fa-4x fa-twitter no-after"></i>
    </a>


    <a class="no-after social-icon" href="https://github.com/singularityware">
      <i class="fa fa-4x fa-github no-after"></i>
    </a>



               </div>

                <div class="col-lg-6 footer">
<p><img src="images/logo/logo.png" alt="Company logo" style="width:40px;padding-bottom:10px"/></p>
 Site last generated: Oct 12, 2017 <br />
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-84672381-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


</html>
