<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="description" content="   Build a Container   These docs are for Singularity Version 2.4. For older versions, see our archive                                         build is the “Swiss army knife” of container creation.  You can use it to download and assemble existing containers from external resources like Singularity Hub and Docker Hub.  You can use it to convert containers between the various formats supported by Singularity.  And you can use it in conjunction with a Singularity recipe file to create a container from scratch and customized it to fit your needs.OverviewThe build command accepts a target as input and produces a container as output.The target defines the method that build uses to create the container. It can be one of the following:  URI beginning with shub:// to build from Singularity Hub  URI beginning with docker:// to build from Docker Hub  path to a existing container on your local machine  path to a directory to build from a sandbox  path to an archive in .tar or compressed .tar.gz format  path to a Singularity recipe fileIn addition build can produce containers in three different formats.  Formats types can be specified by passing the following options to build.  compressed read-only squashfs file system suitable for production (default)  writable ext3 file system suitable for interactive development (--writable option)  writable (ch)root directory called a sandbox for interactive development (--sandbox option)Because build can accept an existing container as a target and create a container in any of these three formats you can convert existing containers from one format to another.The following diagram illustrates the targets that can be supplied to build as inputs and the containers build can produce as outputs.  Green arrows represent operations that can be carried out without root privileges (though the container may not perform properly when run as root).  Red arrows represent operations that must be carried out with root privileges.   Downloading a existing container from Singularity HubYou can use the build command to download a container from Singularity Hub.$ singularity build lolcow.simg shub://GodloveD/lolcowThe first argument (lolcow.simg) specifies a path and name for your container.  The second argument (shub://GodloveD/lolcow) gives the Singularity Hub URI from which to download.But default the container will be converted to a compressed, read-only squashfs file.  If you want your container in a different format use the --writable or --sandbox options.Downloading a existing container from Docker HubYou can use build to download layers from Docker Hub and assemble them into Singularity containers.$ singularity build lolcow.simg docker://godlovedc/lolcowThe same information applies to containers built from Docker Hub and containers built from Singularity Hub.Creating --writable images and --sandbox directories--writableIf you wanted to create a writable ext3 image similar to those used by Singularity version &lt; 2.4, you could do so with the --writable option.  You must create writable containers as root.Extending the Singularity Hub example from above:$ sudo singularity build --writable lolcow.img shub://GodloveD/lolcowThe resulting container is writable, but is still mounted as read-only when executed with commands such as run, exec, and shell.  To mount the container as read-write when using these commands add the --writable option to them as well.To ensure that you have the proper permissions to write to the container as you like, it is also a good idea to make changes as root.  For example:$ sudo singularity shell --writable lolcow.img--sandboxIf you wanted to create a container within a writable directory (called a sandbox) you could do so with the --sandbox option.  It’s possible to create a sandbox without root privileges, but to ensure proper file permissions it is recommended to do so as root.$ sudo singularity build --sandbox lolcow/ shub://GodloveD/lolcowThe resulting directory operates just like a container in an image file.  You are permitted to make changes and write files within the directory, but those changes will not persist when you are finished using the container.  To make your changes persistent, use the --writable flag when you invoke your container.Once again, it’s a good idea to do this as root to ensure you have permission to access the files and directories that you want to change.$ sudo singularity shell --writable lolcow/Converting containers from one format to anotherIf you already have a container saved locally, you can use it as a target to build a new container. This allows you convert containers from one format to another.  For example if you had a squashfs container called production.simg and wanted to convert it to a writeable ext3 container called development.img you could:$ sudo singularity build --writable development.img production.simgSimilarly, to convert it to a writable directory (a sandbox):$ singularity build --sandbox development/ production.simgIf you omit any options you can also convert your sandbox back to a read-only compressed squashfs image suitable for use in a production environment:$ singularity build production2 development/You can convert the three supported container formats using any combination.Use care when converting writable ext3 images or sandbox directories to the default squashfs file format.  If changes were made to the writable container before conversion, there is no record of those changes in the Singularity recipe file rendering your container non-reproducible.  It is a best practice to build your immutable production containers directly from a Singularity recipe file instead.Building containers from Singularity recipe filesOf course, Singularity recipe files can be used as the target when building a container.  For detailed information on writing Singularity recipe files, please see the Container Recipes docs.Let’s say you already have the following container recipe file called Singularity, and you want to use it to build a container.BootStrap: dockerFrom: ubuntu:16.04%post    apt-get -y update    apt-get -y install fortune cowsay lolcat%environment    export LC_ALL=C    export PATH=/usr/games:$PATH%runscript    fortune | cowsay | lolcatYou can do so with the following command.$ sudo singularity build lolcow.simg Singularity The command requires sudo just as installing software on your local machine requires root privileges.--forceYou can build into the same container multiple times (though the results may be unpredictable and it is generally better to delete your container and start from scratch).By default if you build into an existing container, the build command will skip the steps involved in adding a new base.  You can override this default with the --force option requiring that a new base OS is bootstrapped into the existing container.  This behavior does not delete the existing OS, it just adds the new OS on top of the existing one.Use care with this option: you may get results that you did not expect.--sectionIf you only want to build a single section of your Singularity recipe file use the --section option.  For instance, if you have edited the %environment section of a long Singularity recipe and don’t want to completely re-build the container, you could re-build only the %environment section like so:$ sudo singularity build --section environment image.simg SingularityUnder normal build conditions, the Singularity recipe file is saved into a container’s meta-data so that there is a record showing how the container was built.  Using the --section option may render this meta-data useless, so use care if you value reproducibility.--notestIf you don’t want to run the %test section during the container build, you can skip it with the --notest option. For instance, maybe you are building a container intended to run in a production environment with GPUs.  But perhaps your local build resource does not have GPUs.  You want to include a %test section that runs a short validation but you don’t want your build to exit with an error because it cannot find a GPU on your system.$ sudo singularity build GPU.simg --notest Singularity--checksChecks are a new feature (in 2.4) that offer an easy way for an admin to define a security (or any other kind of check) to be run on demand for a Singularity image. They are defined (and run) via different tags.CHECKS OPTIONS:    -c|--checks    enable checks    -t|--tag       specify a check tag (not default)    -l|--low       Specify low threshold (all checks, default)     -m|--med       Perform medium and high checks    -h|--high      Perform only checks at level highWhen you add the --checks option along with applicable tags to the build command Singularity will run the desired checks on your container at build time.  See singularity check --help for available tags.More Build topics  If you want to customize the cache location (where Docker layers are downloaded on your system), specify Docker credentials, or any custom tweaks to your build environment, see build environment.  If you want to make internally modular containers, check out this post.  If you want to build your containers on Singularity Hub, (because you don’t have root access on a Linux machine or want to host your container on the cloud) check out this guide.                Previous        Next                 Edit me                                                                                                                                                 Site last generated: Oct 12, 2017                             ">


<meta name="name" content="Build a Container">

<meta name="thumbnail" content="http://singularity.lbl.gov/images/logo/logo.svg">




<title>Build a Container | Singularity</title>
<link rel="stylesheet" href="assets/css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="assets/css/modern-business.css">
<link rel="stylesheet" href="assets/css/lavish-bootstrap.css">
<link rel="stylesheet" href="assets/css/customstyles.css">
<link rel="stylesheet" href="assets/css/theme-blue.css">

<link rel="stylesheet" type="text/css" href="assets/css/asciinema-player.css" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="assets/js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="assets/js/toc.js"></script>
<script src="assets/js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4005feed.xml">

    <script>
        $(document).ready(function() {

            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- asciinema player -->
<script src="assets/js/asciinema-player.js"></script>

<!-- Show or hide players on button clicks-->
<script>
$( document ).ready(function() {
    $(".asciinema-button").click(function(){
        console.log('rawwwr!')
        var asciinemaVideo = "#" + $(this).attr('data-id');
        if ($(asciinemaVideo).hasClass('hidden')){
            $(asciinemaVideo).removeClass('hidden');
            $(this).text('Hide Tutorial')
        } else {
            $(asciinemaVideo).addClass('hidden');
            $(this).text('Show Tutorial')
        }
        
    });
});
</script>

<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Singularity</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="blog">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Docs<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="admin-guide">Admin Guide</a></li>
                        
                        
                        
                        <li><a href="user-guide">User Guide</a></li>
                        
                        
                        
                        <li><a href="archive">Archive</a></li>
                        
                        
                        
                        <li><a href="links">Contributed Content</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Quick Links<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/singularityware/singularity" target="_blank">Github Repo</a></li>
                        
                        
                        
                        <li><a href="https://groups.google.com/a/lbl.gov/forum/#!forum/singularity" target="_blank">Google Group</a></li>
                        
                        
                        
                        <li><a href="http://stackoverflow.com/questions/tagged/singularity" target="_blank">Singularity on Stack Overflow</a></li>
                        
                        
                        
                        <li><a href="https://singularity-hub.org/faq" target="_blank">Singularity Hub</a></li>
                        
                        
                        
                        <li><a href="https://singularity-container.slack.com" target="_blank">Slack</a></li>
                        
                        
                        
                        <li><a href="faq#troubleshooting">Troubleshooting</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">People<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/gmkurtzer" target="_blank">Gregory M. Kurtzer</a></li>
                        
                        
                        
                        <li><a href="https://github.com/vsoch" target="_blank">Vanessa Sochat</a></li>
                        
                        
                        
                        <li><a href="https://github.com/bauerm97" target="_blank">Michael Bauer</a></li>
                        
                        
                        
                        <li><a href="https://github.com/bbockelm" target="_blank">Brian Bockelman</a></li>
                        
                        
                        
                        <li><a href="https://github.com/singularityware/singularity/blob/master/AUTHORS.md" target="_blank">Complete Authors List</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <li><a href="/search"><i class="fa fa-search"></i></li>
                <!-- jekyll search hidden in favor of google
                <li>
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="assets/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Build a Container">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">
          






<ul id="mysidebar" class="nav">

    
    <div class="shiny"><a href="\"><figure><img src="/images/logo/logo.svg" class="sidebar-logo"/></figure></a></div>
    

    <li class="sidebarTitle">User Guide</li>
    
    
    
    <li>
        <a href="#">Getting Started</a>
        <ul>
            
            
            
            <li><a href="user-guide">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="docs-installation">Installation</a></li>
            
            
            
            
            
            
            <li><a href="quickstart">Quick Start</a></li>
            
            
            
            
            
            
            <li class="active"><a href="docs-build-container">Build a Container</a></li>
            
            
            
            
            
            
            <li><a href="docs-recipes">Container Recipes</a></li>
            
            
            
            
            
            
            <li><a href="docs-flow">Singularity Flow</a></li>
            
            
            
            
            
            
            <li><a href="docs-mount">Bind Paths and Mounts</a></li>
            
            
            
            
            
            
            <li><a href="docs-overlay">Persistent Overlays</a></li>
            
            
            
            
            
            
            <li><a href="docs-instances">Running Services</a></li>
            
            
            
            
            
            
            <li><a href="docs-user-checks">Container Checks</a></li>
            
            
            
            
            
            
            <li><a href="docs-environment-metadata">Environment and Metadata</a></li>
            
            
            
            
            
            
            <li><a href="docs-scif-apps">Reproducible SCI-F Apps</a></li>
            
            
            
            
            
            
            <li><a href="docs-docker">Singularity and Docker</a></li>
            
            
            
            
            
            
            <li><a href="faq#troubleshooting">Troubleshooting</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Commands</a>
        <ul>
            
            
            
            <li><a href="docs-usage">Command Usage</a></li>
            
            
            
            
            
            
            <li><a href="docs-build">build</a></li>
            
            
            
            
            
            
            <li><a href="docs-exec">exec</a></li>
            
            
            
            
            
            
            <li><a href="docs-inspect">inspect</a></li>
            
            
            
            
            
            
            <li><a href="docs-pull">pull</a></li>
            
            
            
            
            
            
            <li><a href="docs-run">run</a></li>
            
            
            
            
            
            
            <li><a href="docs-shell">shell</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Image Command Group</a>
        <ul>
            
            
            
            <li><a href="docs-export">image.export</a></li>
            
            
            
            
            
            
            <li><a href="docs-expand">image.expand</a></li>
            
            
            
            
            
            
            <li><a href="docs-import">image.import</a></li>
            
            
            
            
            
            
            <li><a href="docs-create">image.create</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Instance Command Group</a>
        <ul>
            
            
            
            <li><a href="docs-instance-start">instance.start</a></li>
            
            
            
            
            
            
            <li><a href="docs-instance-list">instance.list</a></li>
            
            
            
            
            
            
            <li><a href="docs-instance-stop">instance.stop</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Deprecated</a>
        <ul>
            
            
            
            <li><a href="docs-bootstrap">bootstrap</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main">Build a Container</h1>
   <small style="color: #666; margin-top:50px; font-variant:italic">These docs are for Singularity Version 2.4. For older versions, see our <a class="no-after" 
                                                               href="https://singularityware.github.io/archive">archive</a></small>
</div>



<div class="post-content">

   

    <!-- Previous and next buttons-->
    <div class="row" style="padding-top:30px; margin-bottom:10px"><div class="col-md-12">
        <a href="#"><button style="float:left" class="hidden previous-button btn btn-circle btn-default"><i class="fa-2x fa fa-angle-double-left"></i></button></a>
        <a href="#"><button style="float:right" class="hidden next-button btn btn-circle btn-default"><i class="fa fa-angle-double-right fa-2x"></i></button></a>
    </div></div>

    <script>
    $(document).ready(function(){

        var next = $("li.active").next().last().find('a').attr('href');
        var previous = $("li.active").prev().last().find('a').attr('href');

        // NEXT BUTTON
        if (typeof next == 'undefined'){
            console.log("disabling next button")
            $(".next-button").addClass("hidden")
        } else if (next == "#") {
            next = $("li.active").next().find("li").first().find('a').attr('href');
            $(".next-button").closest('a').attr('href', next)
            $(".next-button").removeClass('hidden')
        } else {
            $(".next-button").closest('a').attr('href', next)
            $(".next-button").removeClass('hidden')
        }

        // PREVIOUS BUTTON
        if (typeof previous == 'undefined'){
            console.log("disabling previous button")
            $(".previous-button").addClass("hidden")
        } else if (previous == "#") {
            previous = $("li.active").prev().find("li").last().find('a').attr('href')
            $(".previous-button").closest('a').attr('href', previous)
            $(".previous-button").removeClass('hidden')
        } else {
            $(".previous-button").closest('a').attr('href', previous)
            $(".previous-button").removeClass('hidden')
        }

    })
    </script>

    

  <p><code class="highlighter-rouge">build</code> is the “Swiss army knife” of container creation.  You can use it to download and assemble existing containers from external resources like <a href="https://www.singularity-hub.org/" target="_blank">Singularity Hub</a> and <a href="https://hub.docker.com/" target="_blank">Docker Hub</a>.  You can use it to convert containers between the various formats supported by Singularity.  And you can use it in conjunction with a <a href="/docs-recipes">Singularity recipe</a> file to create a container from scratch and customized it to fit your needs.</p>

<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

<h2 id="overview">Overview</h2>
<p>The <code class="highlighter-rouge">build</code> command accepts a target as input and produces a container as output.</p>

<p>The target defines the method that <code class="highlighter-rouge">build</code> uses to create the container. It can be one of the following:</p>

<ul>
  <li>URI beginning with <strong>shub://</strong> to build from Singularity Hub</li>
  <li>URI beginning with <strong>docker://</strong> to build from Docker Hub</li>
  <li>path to a <strong>existing container</strong> on your local machine</li>
  <li>path to a <strong>directory</strong> to build from a sandbox</li>
  <li>path to an <strong>archive</strong> in .tar or compressed .tar.gz format</li>
  <li>path to a <strong><a href="docs-recipes">Singularity recipe file</a></strong></li>
</ul>

<p>In addition <code class="highlighter-rouge">build</code> can produce containers in three different formats.  Formats types can be specified by passing the following options to build.</p>

<ul>
  <li>compressed read-only <strong>squashfs</strong> file system suitable for production (default)</li>
  <li>writable <strong>ext3</strong> file system suitable for interactive development (<code class="highlighter-rouge">--writable</code> option)</li>
  <li>writable <strong>(ch)root directory</strong> called a sandbox for interactive development (<code class="highlighter-rouge">--sandbox</code> option)</li>
</ul>

<p>Because <code class="highlighter-rouge">build</code> can accept an existing container as a target and create a container in any of these three formats you can convert existing containers from one format to another.</p>

<p>The following diagram illustrates the targets that can be supplied to <code class="highlighter-rouge">build</code> as inputs and the containers <code class="highlighter-rouge">build</code> can produce as outputs.  Green arrows represent operations that can be carried out without root privileges (though the container may not perform properly when run as root).  Red arrows represent operations that must be carried out with root privileges.</p>

<div style="text-align: center">
<a href="/assets/img/diagram/build_input_output.svg" target="_blank" class="no-after">
   <img style="max-width:500px" src="/assets/img/diagram/build_input_output.svg" />
</a>
</div>

<h2 id="downloading-a-existing-container-from-singularity-hub">Downloading a existing container from Singularity Hub</h2>
<p>You can use the <code class="highlighter-rouge">build</code> command to download a container from Singularity Hub.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity build lolcow.simg shub://GodloveD/lolcow
</code></pre>
</div>

<p>The first argument (<code class="highlighter-rouge">lolcow.simg</code>) specifies a path and name for your container.  The second argument (<code class="highlighter-rouge">shub://GodloveD/lolcow</code>) gives the Singularity Hub URI from which to download.</p>

<p>But default the container will be converted to a compressed, read-only squashfs file.  If you want your container in a different format use the <code class="highlighter-rouge">--writable</code> or <code class="highlighter-rouge">--sandbox</code> options.</p>

<h2 id="downloading-a-existing-container-from-docker-hub">Downloading a existing container from Docker Hub</h2>
<p>You can use <code class="highlighter-rouge">build</code> to download layers from Docker Hub and assemble them into Singularity containers.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity build lolcow.simg docker://godlovedc/lolcow
</code></pre>
</div>

<p>The same information applies to containers built from Docker Hub and containers built from Singularity Hub.</p>

<h2 id="creating---writable-images-and---sandbox-directories">Creating <code class="highlighter-rouge">--writable</code> images and <code class="highlighter-rouge">--sandbox</code> directories</h2>

<h3 id="--writable"><code class="highlighter-rouge">--writable</code></h3>
<p>If you wanted to create a writable ext3 image similar to those used by Singularity version &lt; 2.4, you could do so with the <code class="highlighter-rouge">--writable</code> option.  You must create writable containers as root.</p>

<p>Extending the Singularity Hub example from above:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity build --writable lolcow.img shub://GodloveD/lolcow
</code></pre>
</div>

<p>The resulting container is writable, but is still mounted as read-only when executed with commands such as <code class="highlighter-rouge">run</code>, <code class="highlighter-rouge">exec</code>, and <code class="highlighter-rouge">shell</code>.  To mount the container as read-write when using these commands add the <code class="highlighter-rouge">--writable</code> option to them as well.</p>

<p>To ensure that you have the proper permissions to write to the container as you like, it is also a good idea to make changes as root.  For example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity shell --writable lolcow.img
</code></pre>
</div>

<h3 id="--sandbox"><code class="highlighter-rouge">--sandbox</code></h3>
<p>If you wanted to create a container within a writable directory (called a <em>sandbox</em>) you could do so with the <code class="highlighter-rouge">--sandbox</code> option.  It’s possible to create a sandbox without root privileges, but to ensure proper file permissions it is recommended to do so as root.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity build --sandbox lolcow/ shub://GodloveD/lolcow
</code></pre>
</div>

<p>The resulting directory operates just like a container in an image file.  You are permitted to make changes and write files within the directory, but those changes will not persist when you are finished using the container.  To make your changes persistent, use the <code class="highlighter-rouge">--writable</code> flag when you invoke your container.</p>

<p>Once again, it’s a good idea to do this as root to ensure you have permission to access the files and directories that you want to change.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity shell --writable lolcow/
</code></pre>
</div>

<h2 id="converting-containers-from-one-format-to-another">Converting containers from one format to another</h2>
<p>If you already have a container saved locally, you can use it as a target to build a new container. This allows you convert containers from one format to another.  For example if you had a squashfs container called <code class="highlighter-rouge">production.simg</code> and wanted to convert it to a writeable ext3 container called <code class="highlighter-rouge">development.img</code> you could:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity build --writable development.img production.simg
</code></pre>
</div>

<p>Similarly, to convert it to a writable directory (a sandbox):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity build --sandbox development/ production.simg
</code></pre>
</div>

<p>If you omit any options you can also convert your sandbox back to a read-only compressed squashfs image suitable for use in a production environment:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity build production2 development/
</code></pre>
</div>
<p>You can convert the three supported container formats using any combination.</p>

<p>Use care when converting writable ext3 images or sandbox directories to the default squashfs file format.  If changes were made to the writable container before conversion, there is no record of those changes in the Singularity recipe file rendering your container non-reproducible.  It is a best practice to build your immutable production containers directly from a Singularity recipe file instead.</p>

<h2 id="building-containers-from-singularity-recipe-files">Building containers from Singularity recipe files</h2>
<p>Of course, Singularity recipe files can be used as the target when building a container.  For detailed information on writing Singularity recipe files, please see <a href="docs-recipes">the Container Recipes docs</a>.</p>

<p>Let’s say you already have the following container recipe file called <code class="highlighter-rouge">Singularity</code>, and you want to use it to build a container.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>BootStrap: docker
From: ubuntu:16.04

%post
    apt-get -y update
    apt-get -y install fortune cowsay lolcat

%environment
    export LC_ALL=C
    export PATH=/usr/games:$PATH

%runscript
    fortune | cowsay | lolcat
</code></pre>
</div>

<p>You can do so with the following command.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity build lolcow.simg Singularity 
</code></pre>
</div>

<p>The command requires <code class="highlighter-rouge">sudo</code> just as installing software on your local machine requires root privileges.</p>

<h3 id="--force"><code class="highlighter-rouge">--force</code></h3>
<p>You can build into the same container multiple times (though the results may be unpredictable and it is generally better to delete your container and start from scratch).</p>

<p>By default if you build into an existing container, the <code class="highlighter-rouge">build</code> command will skip the steps involved in adding a new base.  You can override this default with the <code class="highlighter-rouge">--force</code> option requiring that a new base OS is bootstrapped into the existing container.  This behavior does not delete the existing OS, it just adds the new OS on top of the existing one.</p>

<p>Use care with this option: you may get results that you did not expect.</p>

<h3 id="--section"><code class="highlighter-rouge">--section</code></h3>
<p>If you only want to build a single section of your Singularity recipe file use the <code class="highlighter-rouge">--section</code> option.  For instance, if you have edited the <code class="highlighter-rouge">%environment</code> section of a long Singularity recipe and don’t want to completely re-build the container, you could re-build only the <code class="highlighter-rouge">%environment</code> section like so:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity build --section environment image.simg Singularity
</code></pre>
</div>

<p>Under normal build conditions, the Singularity recipe file is saved into a container’s meta-data so that there is a record showing how the container was built.  Using the <code class="highlighter-rouge">--section</code> option may render this meta-data useless, so use care if you value reproducibility.</p>

<h3 id="--notest"><code class="highlighter-rouge">--notest</code></h3>
<p>If you don’t want to run the <code class="highlighter-rouge">%test</code> section during the container build, you can skip it with the <code class="highlighter-rouge">--notest</code> option. For instance, maybe you are building a container intended to run in a production environment with GPUs.  But perhaps your local build resource does not have GPUs.  You want to include a <code class="highlighter-rouge">%test</code> section that runs a short validation but you don’t want your build to exit with an error because it cannot find a GPU on your system.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity build GPU.simg --notest Singularity
</code></pre>
</div>

<h3 id="--checks"><code class="highlighter-rouge">--checks</code></h3>
<p>Checks are a new feature (in 2.4) that offer an easy way for an admin to define a security (or any other kind of check) to be run on demand for a Singularity image. They are defined (and run) via different tags.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CHECKS OPTIONS:
    -c|--checks    enable checks
    -t|--tag       specify a check tag (not default)
    -l|--low       Specify low threshold (all checks, default) 
    -m|--med       Perform medium and high checks
    -h|--high      Perform only checks at level high
</code></pre>
</div>

<p>When you add the <code class="highlighter-rouge">--checks</code> option along with applicable tags to the <code class="highlighter-rouge">build</code> command Singularity will run the desired checks on your container at build time.  See <code class="highlighter-rouge">singularity check --help</code> for available tags.</p>

<h2 id="more-build-topics">More Build topics</h2>
<ul>
  <li>If you want to <strong>customize the cache location</strong> (where Docker layers are downloaded on your system), specify Docker credentials, or any custom tweaks to your build environment, see <a href="/build-environment">build environment</a>.</li>
  <li>If you want to make internally <strong>modular containers</strong>, check out <a href="http://containers-ftw.org/apps/examples/tutorials/getting-started" target="_blank">this post</a>.</li>
  <li>If you want to <strong>build your containers</strong> on Singularity Hub, (because you don’t have root access on a Linux machine or want to host your container on the cloud) check out <a href="https://github.com/singularityhub/singularityhub.github.io/wiki">this guide</a>.</li>
</ul>

<script>
// Without this, pagination links to exec under repeated build section
$(document).ready(function() {
    $(".next-button").closest('a').attr('href', '/docs-recipes')
})
</script>



    <!-- More navigation on the bottom -->
    <div class="row" style="padding-top:30px; margin-bottom:10px"><div class="col-md-12">
        <a href="#"><button style="width:20%; height: 70px; float:left" class="hidden previous-button btn btn-lg btn-default">Previous</button></a>
        <a href="#"><button style="width:20%; height: 70px; float:right" class="hidden next-button btn btn-lg btn-default">Next</button></a>
    </div></div>


    

    

    <a style="margin-top:10px;margin-bottom:10px" target="_blank" href="https://github.com/singularityware/singularityware.github.io/blob/master/pages/_pages/docs/docs-build-container.md" class="btn btn-default btn-xs githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>
    

    

    <div class="tags">
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">

               <!-- Social Media links, etc -->
               <div class="col-lg-6 footer">
               
    <a class="no-after social-icon" href="https://twitter.com/SingularityApp">
      <i class="fa fa-4x fa-twitter no-after"></i>
    </a>


    <a class="no-after social-icon" href="https://github.com/singularityware">
      <i class="fa fa-4x fa-github no-after"></i>
    </a>



               </div>

                <div class="col-lg-6 footer">
<p><img src="images/logo/logo.png" alt="Company logo" style="width:40px;padding-bottom:10px"/></p>
 Site last generated: Oct 12, 2017 <br />
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-84672381-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


</html>
