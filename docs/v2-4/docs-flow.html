<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="description" content="   Singularity Flow   These docs are for Singularity Version 2.4. For older versions, see our archive                                         This document describes a suggested “best-practices” workflow for building, running, and managing your containers.There are generally two ways to get images. You either want to pull an image file as is, or (more likely) build your own custom image. We will start with talking about build, and the many different use cases it affords.Building ImagesIf you read the quick start, you probably remember that building images from a Docker base does not require a Singularity recipe. However, if you do want to build and customize your image, you can create a Singularity recipe text file, which is a simple text file that describes how the container should be made.The Singularity FlowThe diagram below is a visual depiction of how you can use Singularity to build images. The high level idea is that we have two environments:  a build environment (where you have sudo privileges) to test and build your container  a production environment where you run your container   Singularity production images are immutable. This is a feature added as of Singularity 2.4, and it ensures a higher level of reproducibility and verification of images. To read more about the details, check out the  build docs. However, immutability is not so great when you are testing, debugging, or otherwise want to quickly change your image. We will proceed by describing a typical workflow of developing first, building a final image, and using in production.1. Development CommandsIf you want a writable image or folder for developing, you have two options:  build into a directory that has writable permissions using the --sandbox option  build into an ext3 image file, that has writable permissions with the --writable optionIn both cases you will need to execute your container with the --writable option at runtime for your changes to be persistant.Sandbox FolderTo build into a folder (we call this a “sandbox”) just ask for it:$ sudo singularity build --sandbox ubuntu/ docker://ubuntuDocker image path: index.docker.io/library/ubuntu:latestCache folder set to /root/.singularity/dockerImporting: base Singularity environmentImporting: /root/.singularity/docker/sha256:9fb6c798fa41e509b58bccc5c29654c3ff4648b608f5daa67c1aab6a7d02c118.tar.gzImporting: /root/.singularity/docker/sha256:3b61febd4aefe982e0cb9c696d415137384d1a01052b50a85aae46439e15e49a.tar.gzImporting: /root/.singularity/docker/sha256:9d99b9777eb02b8943c0e72d7a7baec5c782f8fd976825c9d3fb48b3101aacc2.tar.gzImporting: /root/.singularity/docker/sha256:d010c8cf75d7eb5d2504d5ffa0d19696e8d745a457dd8d28ec6dd41d3763617e.tar.gzImporting: /root/.singularity/docker/sha256:7fac07fb303e0589b9c23e6f49d5dc1ff9d6f3c8c88cabe768b430bdb47f03a9.tar.gzImporting: /root/.singularity/metadata/sha256:22e289880847a9a2f32c62c237d2f7e3f4eae7259bf1d5c7ec7ffa19c1a483c8.tar.gzBuilding image from sandbox: ubuntu/Singularity container built: ubuntu/We now have a folder with the entire ubuntu OS, plus some Singularity metadata, plopped in our present working directory.$ tree -L 1 ubuntuubuntu├── bin├── boot├── dev├── environment -&gt; .singularity.d/env/90-environment.sh├── etc├── home├── lib├── lib64├── media├── mnt├── opt├── proc├── root├── run├── sbin├── singularity -&gt; .singularity.d/runscript├── srv├── sys├── tmp├── usr└── varAnd you can shell into it just like a normal container.$ singularity shell ubuntuSingularity: Invoking an interactive shell within container...Singularity ubuntu:~/Desktop&gt; touch /hello.txttouch: cannot touch '/hello.txt': Permission deniedYou can make changes to the container (assuming you have the proper permissions to do so) but those changes will disappear as soon as you exit.  To make your changes persistent across sessions, use the --writable option.  It’s also a good practice to shell into your container as root to ensure you have permissions to write where you like.$ sudo singularity shell ubuntuSingularity: Invoking an interactive shell within container...Singularity ubuntu:/home/vanessa/Desktop&gt; touch /hello.txtWritable ImageIf you prefer to work with a writable image file rather than a directory, you can perform a similar development build and specify the --writable option.This will produce an image that is writable with an ext3 file system. Unlike the sandbox, it is a single image file.$ sudo singularity build --writable ubuntu.img docker://ubuntuDocker image path: index.docker.io/library/ubuntu:latestCache folder set to /root/.singularity/dockerImporting: base Singularity environmentImporting: /root/.singularity/docker/sha256:9fb6c798fa41e509b58bccc5c29654c3ff4648b608f5daa67c1aab6a7d02c118.tar.gzImporting: /root/.singularity/docker/sha256:3b61febd4aefe982e0cb9c696d415137384d1a01052b50a85aae46439e15e49a.tar.gzImporting: /root/.singularity/docker/sha256:9d99b9777eb02b8943c0e72d7a7baec5c782f8fd976825c9d3fb48b3101aacc2.tar.gzImporting: /root/.singularity/docker/sha256:d010c8cf75d7eb5d2504d5ffa0d19696e8d745a457dd8d28ec6dd41d3763617e.tar.gzImporting: /root/.singularity/docker/sha256:7fac07fb303e0589b9c23e6f49d5dc1ff9d6f3c8c88cabe768b430bdb47f03a9.tar.gzImporting: /root/.singularity/metadata/sha256:22e289880847a9a2f32c62c237d2f7e3f4eae7259bf1d5c7ec7ffa19c1a483c8.tar.gzBuilding image from sandbox: /tmp/.singularity-build.VCHPpPCreating empty Singularity writable container 130MBCreating empty 162MiB image file: ubuntu.imgFormatting image with ext3 file systemImage is done: ubuntu.imgBuilding Singularity image...Cleaning up...Singularity container built: ubuntu.imgYou can use this image with commands like shell, exec, run, and if you want to change the image you must use the --writable flag.  As before, it’s a good idea to issue these commands as root to ensure you have the proper permissions to write.$ sudo singularity shell --writable ubuntu.img  Development Tip! When building containers, it often is the case that you will have a lot oftesting of installation commands, and if building a production image, one error will stop the entire build. If youinteractively write the build recipe with one of these writable containers, you can debug as you go, and thenbuild the production (squashfs) container without worrying that it will error and need to be started again.2. Production CommandsLet’s set the scene - we just finished buliding our perfect hello world container. It does a fantastic hello-world analysis, and we have written a paper on it! We now want to build an immutable container - meaning that if someone obtained our container and tried to change it, they could not. They could easily use the same recipe that you used (it is provided as metadata inside the container), or convert your container to one of the writable formats above using build.  So your work can still be extended.Recommended Production BuildWhat we want for production is a build into a squashfs image. Squashfs is a read only, and compressed filesystem, and well suited for confident archive and re-use of your hello-world. To build a production image, just remove the extra options:sudo singularity build ubuntu.simg docker://ubuntuDocker image path: index.docker.io/library/ubuntu:latestCache folder set to /root/.singularity/dockerImporting: base Singularity environmentImporting: /root/.singularity/docker/sha256:9fb6c798fa41e509b58bccc5c29654c3ff4648b608f5daa67c1aab6a7d02c118.tar.gzImporting: /root/.singularity/docker/sha256:3b61febd4aefe982e0cb9c696d415137384d1a01052b50a85aae46439e15e49a.tar.gzImporting: /root/.singularity/docker/sha256:9d99b9777eb02b8943c0e72d7a7baec5c782f8fd976825c9d3fb48b3101aacc2.tar.gzImporting: /root/.singularity/docker/sha256:d010c8cf75d7eb5d2504d5ffa0d19696e8d745a457dd8d28ec6dd41d3763617e.tar.gzImporting: /root/.singularity/docker/sha256:7fac07fb303e0589b9c23e6f49d5dc1ff9d6f3c8c88cabe768b430bdb47f03a9.tar.gzImporting: /root/.singularity/metadata/sha256:22e289880847a9a2f32c62c237d2f7e3f4eae7259bf1d5c7ec7ffa19c1a483c8.tar.gzBuilding Singularity image...Cleaning up...Singularity container built: ubuntu.simgProduction Build from SandboxWe understand that it might be wanted to build a Singularity (squashfs) from a previous development image. While we advocate for the first approach, we support this use case. To do this, given our folder called “ubuntu/” we made above:sudo singularity build ubuntu.simg ubuntu/It could be the case that a cluster maintains a “working” base of container folders (with writable) and then builds and provides production containers to its users.If you want to go through this entire process without having singularity installed locally, or without leaving your cluster, you can build images using singularity hub.                Previous        Next                 Edit me                                                                                                                                                 Site last generated: Oct 12, 2017                             ">


<meta name="name" content="Singularity Flow">

<meta name="thumbnail" content="http://singularity.lbl.gov/images/logo/logo.svg">




<title>Singularity Flow | Singularity</title>
<link rel="stylesheet" href="assets/css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="assets/css/modern-business.css">
<link rel="stylesheet" href="assets/css/lavish-bootstrap.css">
<link rel="stylesheet" href="assets/css/customstyles.css">
<link rel="stylesheet" href="assets/css/theme-blue.css">

<link rel="stylesheet" type="text/css" href="assets/css/asciinema-player.css" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="assets/js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="assets/js/toc.js"></script>
<script src="assets/js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4005feed.xml">

    <script>
        $(document).ready(function() {

            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- asciinema player -->
<script src="assets/js/asciinema-player.js"></script>

<!-- Show or hide players on button clicks-->
<script>
$( document ).ready(function() {
    $(".asciinema-button").click(function(){
        console.log('rawwwr!')
        var asciinemaVideo = "#" + $(this).attr('data-id');
        if ($(asciinemaVideo).hasClass('hidden')){
            $(asciinemaVideo).removeClass('hidden');
            $(this).text('Hide Tutorial')
        } else {
            $(asciinemaVideo).addClass('hidden');
            $(this).text('Show Tutorial')
        }
        
    });
});
</script>

<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Singularity</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="blog">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Docs<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="admin-guide">Admin Guide</a></li>
                        
                        
                        
                        <li><a href="user-guide">User Guide</a></li>
                        
                        
                        
                        <li><a href="archive">Archive</a></li>
                        
                        
                        
                        <li><a href="links">Contributed Content</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Quick Links<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/singularityware/singularity" target="_blank">Github Repo</a></li>
                        
                        
                        
                        <li><a href="https://groups.google.com/a/lbl.gov/forum/#!forum/singularity" target="_blank">Google Group</a></li>
                        
                        
                        
                        <li><a href="http://stackoverflow.com/questions/tagged/singularity" target="_blank">Singularity on Stack Overflow</a></li>
                        
                        
                        
                        <li><a href="https://singularity-hub.org/faq" target="_blank">Singularity Hub</a></li>
                        
                        
                        
                        <li><a href="https://singularity-container.slack.com" target="_blank">Slack</a></li>
                        
                        
                        
                        <li><a href="faq#troubleshooting">Troubleshooting</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">People<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/gmkurtzer" target="_blank">Gregory M. Kurtzer</a></li>
                        
                        
                        
                        <li><a href="https://github.com/vsoch" target="_blank">Vanessa Sochat</a></li>
                        
                        
                        
                        <li><a href="https://github.com/bauerm97" target="_blank">Michael Bauer</a></li>
                        
                        
                        
                        <li><a href="https://github.com/bbockelm" target="_blank">Brian Bockelman</a></li>
                        
                        
                        
                        <li><a href="https://github.com/singularityware/singularity/blob/master/AUTHORS.md" target="_blank">Complete Authors List</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <li><a href="/search"><i class="fa fa-search"></i></li>
                <!-- jekyll search hidden in favor of google
                <li>
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="assets/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Singularity Flow">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">
          






<ul id="mysidebar" class="nav">

    
    <div class="shiny"><a href="\"><figure><img src="/images/logo/logo.svg" class="sidebar-logo"/></figure></a></div>
    

    <li class="sidebarTitle">User Guide</li>
    
    
    
    <li>
        <a href="#">Getting Started</a>
        <ul>
            
            
            
            <li><a href="user-guide">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="docs-installation">Installation</a></li>
            
            
            
            
            
            
            <li><a href="quickstart">Quick Start</a></li>
            
            
            
            
            
            
            <li><a href="docs-build-container">Build a Container</a></li>
            
            
            
            
            
            
            <li><a href="docs-recipes">Container Recipes</a></li>
            
            
            
            
            
            
            <li class="active"><a href="docs-flow">Singularity Flow</a></li>
            
            
            
            
            
            
            <li><a href="docs-mount">Bind Paths and Mounts</a></li>
            
            
            
            
            
            
            <li><a href="docs-overlay">Persistent Overlays</a></li>
            
            
            
            
            
            
            <li><a href="docs-instances">Running Services</a></li>
            
            
            
            
            
            
            <li><a href="docs-user-checks">Container Checks</a></li>
            
            
            
            
            
            
            <li><a href="docs-environment-metadata">Environment and Metadata</a></li>
            
            
            
            
            
            
            <li><a href="docs-scif-apps">Reproducible SCI-F Apps</a></li>
            
            
            
            
            
            
            <li><a href="docs-docker">Singularity and Docker</a></li>
            
            
            
            
            
            
            <li><a href="faq#troubleshooting">Troubleshooting</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Commands</a>
        <ul>
            
            
            
            <li><a href="docs-usage">Command Usage</a></li>
            
            
            
            
            
            
            <li><a href="docs-build">build</a></li>
            
            
            
            
            
            
            <li><a href="docs-exec">exec</a></li>
            
            
            
            
            
            
            <li><a href="docs-inspect">inspect</a></li>
            
            
            
            
            
            
            <li><a href="docs-pull">pull</a></li>
            
            
            
            
            
            
            <li><a href="docs-run">run</a></li>
            
            
            
            
            
            
            <li><a href="docs-shell">shell</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Image Command Group</a>
        <ul>
            
            
            
            <li><a href="docs-export">image.export</a></li>
            
            
            
            
            
            
            <li><a href="docs-expand">image.expand</a></li>
            
            
            
            
            
            
            <li><a href="docs-import">image.import</a></li>
            
            
            
            
            
            
            <li><a href="docs-create">image.create</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Instance Command Group</a>
        <ul>
            
            
            
            <li><a href="docs-instance-start">instance.start</a></li>
            
            
            
            
            
            
            <li><a href="docs-instance-list">instance.list</a></li>
            
            
            
            
            
            
            <li><a href="docs-instance-stop">instance.stop</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Deprecated</a>
        <ul>
            
            
            
            <li><a href="docs-bootstrap">bootstrap</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main">Singularity Flow</h1>
   <small style="color: #666; margin-top:50px; font-variant:italic">These docs are for Singularity Version 2.4. For older versions, see our <a class="no-after" 
                                                               href="https://singularityware.github.io/archive">archive</a></small>
</div>



<div class="post-content">

   

    <!-- Previous and next buttons-->
    <div class="row" style="padding-top:30px; margin-bottom:10px"><div class="col-md-12">
        <a href="#"><button style="float:left" class="hidden previous-button btn btn-circle btn-default"><i class="fa-2x fa fa-angle-double-left"></i></button></a>
        <a href="#"><button style="float:right" class="hidden next-button btn btn-circle btn-default"><i class="fa fa-angle-double-right fa-2x"></i></button></a>
    </div></div>

    <script>
    $(document).ready(function(){

        var next = $("li.active").next().last().find('a').attr('href');
        var previous = $("li.active").prev().last().find('a').attr('href');

        // NEXT BUTTON
        if (typeof next == 'undefined'){
            console.log("disabling next button")
            $(".next-button").addClass("hidden")
        } else if (next == "#") {
            next = $("li.active").next().find("li").first().find('a').attr('href');
            $(".next-button").closest('a').attr('href', next)
            $(".next-button").removeClass('hidden')
        } else {
            $(".next-button").closest('a').attr('href', next)
            $(".next-button").removeClass('hidden')
        }

        // PREVIOUS BUTTON
        if (typeof previous == 'undefined'){
            console.log("disabling previous button")
            $(".previous-button").addClass("hidden")
        } else if (previous == "#") {
            previous = $("li.active").prev().find("li").last().find('a').attr('href')
            $(".previous-button").closest('a').attr('href', previous)
            $(".previous-button").removeClass('hidden')
        } else {
            $(".previous-button").closest('a').attr('href', previous)
            $(".previous-button").removeClass('hidden')
        }

    })
    </script>

    

  <p>This document describes a suggested “best-practices” workflow for building, running, and managing your containers.</p>

<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

<p>There are generally two ways to get images. You either want to pull an image file as is, or (more likely) build your own custom image. We will start with talking about build, and the many different use cases it affords.</p>

<h2 id="building-images">Building Images</h2>
<p>If you read the <a href="/quickstart">quick start</a>, you probably remember that building images from a Docker base does not require a <a href="/docs-recipes">Singularity recipe</a>. However, if you <em>do</em> want to build and customize your image, you can create a <a href="/docs-recipes">Singularity recipe</a> text file, which is a simple text file that describes how the container should be made.</p>

<h3 id="the-singularity-flow">The Singularity Flow</h3>
<p>The diagram below is a visual depiction of how you can use Singularity to build images. The high level idea is that we have two environments:</p>

<ul>
  <li>a <strong>build</strong> environment (where you have sudo privileges) to test and build your container</li>
  <li>a <strong>production</strong> environment where you run your container</li>
</ul>

<p><a href="/assets/img/diagram/singularity-2.4-flow.png" target="_blank" class="no-after">
   <img style="max-width:900px" src="/assets/img/diagram/singularity-2.4-flow.png" />
</a></p>

<p>Singularity production images are immutable. This is a feature added as of Singularity 2.4, and it ensures a higher level of reproducibility and verification of images. To read more about the details, check out the  <a href="docs-build-container">build</a> docs. However, immutability is not so great when you are testing, debugging, or otherwise want to quickly change your image. We will proceed by describing a typical workflow of developing first, building a final image, and using in production.</p>

<h3 id="1-development-commands">1. Development Commands</h3>
<p>If you want a writable image or folder for developing, you have two options:</p>

<ol>
  <li>build into a directory that has writable permissions using the <code class="highlighter-rouge">--sandbox</code> option</li>
  <li>build into an ext3 image file, that has writable permissions with the <code class="highlighter-rouge">--writable</code> option</li>
</ol>

<p>In both cases you will need to execute your container with the <code class="highlighter-rouge">--writable</code> option at runtime for your changes to be persistant.</p>

<h4 id="sandbox-folder">Sandbox Folder</h4>
<p>To build into a folder (we call this a “sandbox”) just ask for it:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity build --sandbox ubuntu/ docker://ubuntu
Docker image path: index.docker.io/library/ubuntu:latest
Cache folder set to /root/.singularity/docker
Importing: base Singularity environment
Importing: /root/.singularity/docker/sha256:9fb6c798fa41e509b58bccc5c29654c3ff4648b608f5daa67c1aab6a7d02c118.tar.gz
Importing: /root/.singularity/docker/sha256:3b61febd4aefe982e0cb9c696d415137384d1a01052b50a85aae46439e15e49a.tar.gz
Importing: /root/.singularity/docker/sha256:9d99b9777eb02b8943c0e72d7a7baec5c782f8fd976825c9d3fb48b3101aacc2.tar.gz
Importing: /root/.singularity/docker/sha256:d010c8cf75d7eb5d2504d5ffa0d19696e8d745a457dd8d28ec6dd41d3763617e.tar.gz
Importing: /root/.singularity/docker/sha256:7fac07fb303e0589b9c23e6f49d5dc1ff9d6f3c8c88cabe768b430bdb47f03a9.tar.gz
Importing: /root/.singularity/metadata/sha256:22e289880847a9a2f32c62c237d2f7e3f4eae7259bf1d5c7ec7ffa19c1a483c8.tar.gz
Building image from sandbox: ubuntu/
Singularity container built: ubuntu/
</code></pre>
</div>

<p>We now have a folder with the entire ubuntu OS, plus some Singularity metadata, plopped in our present working directory.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ tree -L 1 ubuntu
ubuntu
├── bin
├── boot
├── dev
├── environment -&gt; .singularity.d/env/90-environment.sh
├── etc
├── home
├── lib
├── lib64
├── media
├── mnt
├── opt
├── proc
├── root
├── run
├── sbin
├── singularity -&gt; .singularity.d/runscript
├── srv
├── sys
├── tmp
├── usr
└── var
</code></pre>
</div>

<p>And you can shell into it just like a normal container.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ singularity shell ubuntu
Singularity: Invoking an interactive shell within container...

Singularity ubuntu:~/Desktop&gt; touch /hello.txt
touch: cannot touch '/hello.txt': Permission denied
</code></pre>
</div>
<p>You can make changes to the container (assuming you have the proper permissions to do so) but those changes will disappear as soon as you exit.  To make your changes persistent across sessions, use the <code class="highlighter-rouge">--writable</code> option.  It’s also a good practice to shell into your container as root to ensure you have permissions to write where you like.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity shell ubuntu
Singularity: Invoking an interactive shell within container...

Singularity ubuntu:/home/vanessa/Desktop&gt; touch /hello.txt
</code></pre>
</div>

<h4 id="writable-image">Writable Image</h4>
<p>If you prefer to work with a writable image file rather than a directory, you can perform a similar development build and specify the <code class="highlighter-rouge">--writable</code> option.
This will produce an image that is writable with an ext3 file system. Unlike the sandbox, it is a single image file.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity build --writable ubuntu.img docker://ubuntu
Docker image path: index.docker.io/library/ubuntu:latest
Cache folder set to /root/.singularity/docker
Importing: base Singularity environment
Importing: /root/.singularity/docker/sha256:9fb6c798fa41e509b58bccc5c29654c3ff4648b608f5daa67c1aab6a7d02c118.tar.gz
Importing: /root/.singularity/docker/sha256:3b61febd4aefe982e0cb9c696d415137384d1a01052b50a85aae46439e15e49a.tar.gz
Importing: /root/.singularity/docker/sha256:9d99b9777eb02b8943c0e72d7a7baec5c782f8fd976825c9d3fb48b3101aacc2.tar.gz
Importing: /root/.singularity/docker/sha256:d010c8cf75d7eb5d2504d5ffa0d19696e8d745a457dd8d28ec6dd41d3763617e.tar.gz
Importing: /root/.singularity/docker/sha256:7fac07fb303e0589b9c23e6f49d5dc1ff9d6f3c8c88cabe768b430bdb47f03a9.tar.gz
Importing: /root/.singularity/metadata/sha256:22e289880847a9a2f32c62c237d2f7e3f4eae7259bf1d5c7ec7ffa19c1a483c8.tar.gz
Building image from sandbox: /tmp/.singularity-build.VCHPpP
Creating empty Singularity writable container 130MB
Creating empty 162MiB image file: ubuntu.img
Formatting image with ext3 file system
Image is done: ubuntu.img
Building Singularity image...
Cleaning up...
Singularity container built: ubuntu.img
</code></pre>
</div>

<p>You can use this image with commands like <code class="highlighter-rouge">shell</code>, <code class="highlighter-rouge">exec</code>, <code class="highlighter-rouge">run</code>, and if you want to change the image you must use the <code class="highlighter-rouge">--writable</code> flag.  As before, it’s a good idea to issue these commands as root to ensure you have the proper permissions to write.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo singularity shell --writable ubuntu.img
</code></pre>
</div>

<blockquote>
  <p>Development Tip! When building containers, it often is the case that you will have a lot of
testing of installation commands, and if building a production image, one error will stop the entire build. If you
interactively write the build recipe with one of these writable containers, you can debug as you go, and then
build the production (squashfs) container without worrying that it will error and need to be started again.</p>
</blockquote>

<h3 id="2-production-commands">2. Production Commands</h3>
<p>Let’s set the scene - we just finished buliding our perfect hello world container. It does a fantastic hello-world analysis, and we have written a paper on it! We now want to build an immutable container - meaning that if someone obtained our container and tried to change it, they could not. They <em>could</em> easily use the same recipe that you used (it is provided as metadata inside the container), or convert your container to one of the writable formats above using <code class="highlighter-rouge">build</code>.  So your work can still be extended.</p>

<h4 id="recommended-production-build">Recommended Production Build</h4>
<p>What we want for production is a build into a <a href="https://en.wikipedia.org/wiki/SquashFS" target="_blank">squashfs image</a>. Squashfs is a read only, and compressed filesystem, and well suited for confident archive and re-use of your hello-world. To build a production image, just remove the extra options:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo singularity build ubuntu.simg docker://ubuntu
Docker image path: index.docker.io/library/ubuntu:latest
Cache folder set to /root/.singularity/docker
Importing: base Singularity environment
Importing: /root/.singularity/docker/sha256:9fb6c798fa41e509b58bccc5c29654c3ff4648b608f5daa67c1aab6a7d02c118.tar.gz
Importing: /root/.singularity/docker/sha256:3b61febd4aefe982e0cb9c696d415137384d1a01052b50a85aae46439e15e49a.tar.gz
Importing: /root/.singularity/docker/sha256:9d99b9777eb02b8943c0e72d7a7baec5c782f8fd976825c9d3fb48b3101aacc2.tar.gz
Importing: /root/.singularity/docker/sha256:d010c8cf75d7eb5d2504d5ffa0d19696e8d745a457dd8d28ec6dd41d3763617e.tar.gz
Importing: /root/.singularity/docker/sha256:7fac07fb303e0589b9c23e6f49d5dc1ff9d6f3c8c88cabe768b430bdb47f03a9.tar.gz
Importing: /root/.singularity/metadata/sha256:22e289880847a9a2f32c62c237d2f7e3f4eae7259bf1d5c7ec7ffa19c1a483c8.tar.gz
Building Singularity image...
Cleaning up...
Singularity container built: ubuntu.simg
</code></pre>
</div>
<h4 id="production-build-from-sandbox">Production Build from Sandbox</h4>
<p>We understand that it might be wanted to build a Singularity (squashfs) from a previous development image. While we advocate for the first approach, we support this use case. To do this, given our folder called “ubuntu/” we made above:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo singularity build ubuntu.simg ubuntu/
</code></pre>
</div>
<p>It could be the case that a cluster maintains a “working” base of container folders (with writable) and then builds and provides production containers to its users.</p>

<p>If you want to go through this entire process without having singularity installed locally, or without leaving your cluster, you can build images using <a href="https://github.com/singularityhub/singularityhub.github.io/wiki" target="_blank">singularity hub.</a></p>



    <!-- More navigation on the bottom -->
    <div class="row" style="padding-top:30px; margin-bottom:10px"><div class="col-md-12">
        <a href="#"><button style="width:20%; height: 70px; float:left" class="hidden previous-button btn btn-lg btn-default">Previous</button></a>
        <a href="#"><button style="width:20%; height: 70px; float:right" class="hidden next-button btn btn-lg btn-default">Next</button></a>
    </div></div>


    

    

    <a style="margin-top:10px;margin-bottom:10px" target="_blank" href="https://github.com/singularityware/singularityware.github.io/blob/master/pages/_pages/docs/docs-flow.md" class="btn btn-default btn-xs githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>
    

    

    <div class="tags">
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">

               <!-- Social Media links, etc -->
               <div class="col-lg-6 footer">
               
    <a class="no-after social-icon" href="https://twitter.com/SingularityApp">
      <i class="fa fa-4x fa-twitter no-after"></i>
    </a>


    <a class="no-after social-icon" href="https://github.com/singularityware">
      <i class="fa fa-4x fa-github no-after"></i>
    </a>



               </div>

                <div class="col-lg-6 footer">
<p><img src="images/logo/logo.png" alt="Company logo" style="width:40px;padding-bottom:10px"/></p>
 Site last generated: Oct 12, 2017 <br />
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-84672381-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


</html>
